import{c as o,a as e,o as n,d as re,i as d,r as de,h as _,K as ce,n as ue,p as u,z as me,f as c,b as g,e as r,v as w,F as E,q as T,t as a,g as Z,B as K,s as M,H as pe,w as Q,y as ve,k as he,L as fe}from"./index-BFEQWBay.js";import{_ as R}from"./Modal.vue_vue_type_script_setup_true_lang-DrVpGJl3.js";import{r as _e}from"./PlusIcon-NzFvHLfC.js";import{r as xe,a as be}from"./ChevronRightIcon-350qRXwI.js";import{r as ge}from"./PencilSquareIcon-DVxBfWgh.js";import{f as D,p as B}from"./parseISO-Crjmnvoz.js";function we(V,m){return n(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M20.25 8.511c.884.284 1.5 1.128 1.5 2.097v4.286c0 1.136-.847 2.1-1.98 2.193-.34.027-.68.052-1.02.072v3.091l-3-3c-1.354 0-2.694-.055-4.02-.163a2.115 2.115 0 0 1-.825-.242m9.345-8.334a2.126 2.126 0 0 0-.476-.095 48.64 48.64 0 0 0-8.048 0c-1.131.094-1.976 1.057-1.976 2.192v4.286c0 .837.46 1.58 1.155 1.951m9.345-8.334V6.637c0-1.621-1.152-3.026-2.76-3.235A48.455 48.455 0 0 0 11.25 3c-2.115 0-4.198.137-6.24.402-1.608.209-2.76 1.614-2.76 3.235v6.226c0 1.621 1.152 3.026 2.76 3.235.577.075 1.157.14 1.74.194V21l4.155-4.155"})])}function ye(V,m){return n(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})])}function ke(V,m){return n(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9.568 3H5.25A2.25 2.25 0 0 0 3 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 0 0 5.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 0 0 9.568 3Z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 6h.008v.008H6V6Z"})])}const Ce={class:"space-y-6"},Me={class:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4"},Ve={class:"flex items-center gap-2"},je={class:"relative w-full md:w-64"},Ne={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},$e={class:"card overflow-hidden"},Ae={class:"overflow-x-auto"},Ee={class:"min-w-full divide-y divide-slate-200 dark:divide-slate-700"},Te={class:"divide-y divide-slate-200 dark:divide-slate-700 bg-white dark:bg-slate-900"},De={key:1},Be={class:"text-center py-10",colspan:"5"},Pe={class:"text-center text-slate-500"},Ue={key:0,class:"text-sm"},Le=["onClick"],Se={class:"px-6 py-4 whitespace-nowrap"},Fe={class:"flex items-center"},qe={class:"flex-shrink-0 h-10 w-10"},He={class:"h-10 w-10 rounded-full bg-slate-200 dark:bg-slate-700 flex items-center justify-center font-bold text-slate-600 dark:text-slate-300"},Ie={class:"ml-4"},ze={class:"text-sm font-medium text-slate-900 dark:text-slate-100"},Oe={class:"text-sm text-slate-500 dark:text-slate-400 lg:hidden"},Ze={class:"px-6 py-4 whitespace-nowrap hidden sm:table-cell"},Ke={class:"text-sm text-slate-900 dark:text-slate-100"},Qe={class:"text-sm text-slate-500 dark:text-slate-400"},Re={class:"px-6 py-4 whitespace-nowrap text-center hidden md:table-cell"},Ge={class:"text-sm text-slate-500 dark:text-slate-400"},Je={key:0,class:"ml-2 badge badge-success"},We={class:"px-6 py-4 whitespace-nowrap text-sm text-slate-500 dark:text-slate-400 hidden lg:table-cell"},Xe={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},Ye=["onClick"],et={key:0,class:"card-footer flex items-center justify-between"},tt={class:"text-sm text-slate-600 dark:text-slate-400"},st={class:"flex items-center gap-1"},lt=["disabled"],at=["disabled"],nt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ot={class:"flex justify-end gap-3 pt-4"},it=["disabled"],rt={class:"space-y-4"},dt={class:"text-sm text-slate-500 dark:text-slate-400"},ct={class:"space-y-3 max-h-[60vh] overflow-y-auto -m-3 p-3 pretty-scrollbar"},ut={key:0,class:"text-center py-10 text-slate-500"},mt={class:"card-body"},pt={class:"flex items-start justify-between"},vt={class:"font-medium text-slate-800 dark:text-slate-200"},ht={class:"text-sm text-slate-500 dark:text-slate-400"},ft={class:"mt-2 text-sm text-slate-600 dark:text-slate-300 space-y-1"},_t={key:0,class:"flex items-center gap-2"},xt={key:1,class:"flex items-center gap-2"},bt={key:2,class:"pt-1 flex items-start gap-2"},gt={class:"italic"},P=10,jt=re({__name:"Clients",setup(V){const{addToast:m}=pe(),G=fe(),j=d([]),x=d([]),y=d(!0),k=d(!1),h=d(""),p=d(1),C=d(!1),v=d(null),U=d(!1),b=d(null),i=de({name:"",phone_number:"",email:"",notes:""}),L=_(()=>{if(!h.value)return j.value;const l=h.value.toLowerCase();return j.value.filter(t=>t.name.toLowerCase().includes(l)||t.phone_number&&t.phone_number.includes(l)||t.email&&t.email.toLowerCase().includes(l))}),N=_(()=>Math.ceil(L.value.length/P)),S=_(()=>(p.value-1)*P),J=_(()=>S.value+P),F=_(()=>L.value.slice(S.value,J.value)),$=_(()=>b.value?x.value.filter(l=>l.client_id===b.value.id).sort((l,t)=>new Date(t.start_time).getTime()-new Date(l.start_time).getTime()):[]),W=l=>l.split(" ").map(t=>t[0]).join("").toUpperCase().slice(0,2),X=l=>x.value.filter(t=>t.client_id===l).length,q=l=>{const t=new Date;return x.value.filter(s=>s.client_id===l&&new Date(s.start_time)>t&&s.status!=="cancelled").length},Y=l=>{const t=x.value.filter(s=>s.client_id===l&&s.status==="completed").sort((s,f)=>new Date(f.start_time).getTime()-new Date(s.start_time).getTime());return t.length===0?"Never":D(B(t[0].start_time),"MMM d, yyyy")},ee=l=>({scheduled:"badge-info",completed:"badge-success",cancelled:"badge-error","no-show":"badge-warning"})[l]||"badge-default",H=()=>{Object.assign(i,{name:"",phone_number:"",email:"",notes:""})},te=()=>{v.value=null,H(),C.value=!0},se=l=>{v.value=l,Object.assign(i,{name:l.name,phone_number:l.phone_number||"",email:l.email||"",notes:l.notes||""}),C.value=!0},A=()=>{C.value=!1,v.value=null,H()},le=()=>{U.value=!1,b.value=null},ae=async()=>{if(!i.name.trim()){m({type:"error",title:"Validation Error",message:"Client name is required"});return}k.value=!0;try{const l={name:i.name.trim(),phone_number:i.phone_number.trim()||null,email:i.email.trim()||null,notes:i.notes.trim()||null};if(v.value){const{error:t}=await M.from("clients").update(l).eq("id",v.value.id);if(t)throw t;m({type:"success",title:"Success",message:"Client updated successfully"})}else{const{error:t}=await M.from("clients").insert(l);if(t)throw t;m({type:"success",title:"Success",message:"Client created successfully"})}A(),await I()}catch(l){m({type:"error",title:"Error",message:l.message||"Failed to save client"})}finally{k.value=!1}},I=async()=>{y.value=!0;try{const{data:l,error:t}=await M.from("clients").select("*").order("name");if(t)throw t;j.value=l||[]}catch{m({type:"error",title:"Error",message:"Failed to fetch clients"})}finally{y.value=!1}},ne=async()=>{try{const{data:l,error:t}=await M.from("appointments").select("*, barber:barbers(name), services:appointment_services(service:services(name))");if(t)throw t;x.value=l||[]}catch(l){console.error("Error fetching appointments:",l)}},oe=l=>{G.push({name:"ClientProfile",params:{id:l.id}})};return ce(h,()=>{p.value=1}),ue(async()=>{await I(),await ne()}),(l,t)=>(n(),o("div",Ce,[e("div",Me,[t[8]||(t[8]=e("h1",{class:"text-2xl font-bold text-slate-900 dark:text-slate-100"},"Clients",-1)),e("div",Ve,[e("div",je,[e("div",Ne,[u(r(ye),{class:"h-5 w-5 text-slate-400"})]),g(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>h.value=s),type:"text",placeholder:"Search clients...",class:"input pl-10 w-full"},null,512),[[w,h.value]])]),e("button",{onClick:te,class:"btn btn-primary"},[u(r(_e),{class:"w-4 h-4 md:mr-2"}),t[7]||(t[7]=e("span",{class:"hidden md:inline"},"New Client",-1))])])]),e("div",$e,[e("div",Ae,[e("table",Ee,[t[12]||(t[12]=e("thead",{class:"bg-slate-50 dark:bg-slate-800"},[e("tr",null,[e("th",{scope:"col",class:"table-header px-6 py-3 text-left"},"Client"),e("th",{scope:"col",class:"table-header px-6 py-3 text-left hidden sm:table-cell"},"Contact"),e("th",{scope:"col",class:"table-header px-6 py-3 text-center hidden md:table-cell"},"Appointments"),e("th",{scope:"col",class:"table-header px-6 py-3 text-left hidden lg:table-cell"},"Last Visit"),e("th",{scope:"col",class:"table-header px-6 py-3 text-right"},"Actions")])],-1)),e("tbody",Te,[y.value?(n(),o(E,{key:0},T(5,s=>e("tr",{key:s},t[9]||(t[9]=[e("td",{class:"px-6 py-4 whitespace-nowrap",colspan:"5"},[e("div",{class:"animate-pulse flex space-x-4"},[e("div",{class:"rounded-full bg-slate-200 dark:bg-slate-700 h-10 w-10"}),e("div",{class:"flex-1 space-y-2 py-1"},[e("div",{class:"h-2 bg-slate-200 dark:bg-slate-700 rounded"}),e("div",{class:"h-2 bg-slate-200 dark:bg-slate-700 rounded w-5/6"})])])],-1)]))),64)):c("",!0),!y.value&&F.value.length===0?(n(),o("tr",De,[e("td",Be,[e("div",Pe,[t[10]||(t[10]=e("p",{class:"font-medium"},"No clients found",-1)),h.value?(n(),o("p",Ue,"Try adjusting your search.")):c("",!0)])])])):c("",!0),(n(!0),o(E,null,T(F.value,s=>(n(),o("tr",{key:s.id,class:"hover:bg-slate-50 dark:hover:bg-slate-800/50 cursor-pointer",onClick:f=>oe(s)},[e("td",Se,[e("div",Fe,[e("div",qe,[e("div",He,a(W(s.name)),1)]),e("div",Ie,[e("div",ze,a(s.name),1),e("div",Oe,a(s.email||s.phone_number),1)])])]),e("td",Ze,[e("div",Ke,a(s.email),1),e("div",Qe,a(s.phone_number),1)]),e("td",Re,[e("span",Ge,a(X(s.id))+" Total",1),q(s.id)>0?(n(),o("span",Je,a(q(s.id))+" Upcoming",1)):c("",!0)]),e("td",We,a(Y(s.id)),1),e("td",Xe,[e("button",{onClick:Q(f=>se(s),["stop"]),class:"btn btn-sm btn-ghost"},[u(r(ge),{class:"w-5 h-5"}),t[11]||(t[11]=e("span",{class:"sr-only"},"Edit",-1))],8,Ye)])],8,Le))),128))])])]),N.value>1?(n(),o("div",et,[e("div",tt," Page "+a(p.value)+" of "+a(N.value),1),e("div",st,[e("button",{onClick:t[1]||(t[1]=s=>p.value--),disabled:p.value===1,class:"btn btn-sm btn-outline"},[u(r(xe),{class:"h-4 w-4"}),t[13]||(t[13]=Z(" Previous "))],8,lt),e("button",{onClick:t[2]||(t[2]=s=>p.value++),disabled:p.value>=N.value,class:"btn btn-sm btn-outline"},[t[14]||(t[14]=Z(" Next ")),u(r(be),{class:"h-4 w-4"})],8,at)])])):c("",!0)]),u(R,{"is-open":C.value,title:v.value?"Edit Client":"Add New Client",onClose:A},{default:K(()=>[e("form",{onSubmit:Q(ae,["prevent"]),class:"space-y-4"},[e("div",null,[t[15]||(t[15]=e("label",{class:"label"},"Full Name *",-1)),g(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>i.name=s),type:"text",required:"",class:"input",placeholder:"Enter client's full name"},null,512),[[w,i.name]])]),e("div",nt,[e("div",null,[t[16]||(t[16]=e("label",{class:"label"},"Phone Number",-1)),g(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>i.phone_number=s),type:"tel",class:"input",placeholder:"(555) 123-4567"},null,512),[[w,i.phone_number]])]),e("div",null,[t[17]||(t[17]=e("label",{class:"label"},"Email Address",-1)),g(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>i.email=s),type:"email",class:"input",placeholder:"client@example.com"},null,512),[[w,i.email]])])]),e("div",null,[t[18]||(t[18]=e("label",{class:"label"},"Notes",-1)),g(e("textarea",{"onUpdate:modelValue":t[6]||(t[6]=s=>i.notes=s),rows:"4",class:"textarea",placeholder:"Any preferences, allergies, or other notes..."},null,512),[[w,i.notes]])]),e("div",ot,[e("button",{type:"button",onClick:A,class:"btn btn-secondary"}," Cancel "),e("button",{type:"submit",disabled:k.value,class:"btn btn-primary"},a(k.value?"Saving...":v.value?"Update Client":"Create Client"),9,it)])],32)]),_:1},8,["is-open","title"]),b.value?(n(),me(R,{key:0,"is-open":U.value,title:`${b.value.name}`,size:"lg",onClose:le},{default:K(()=>[e("div",rt,[e("div",dt," Total appointments: "+a($.value.length),1),e("div",ct,[$.value.length===0?(n(),o("div",ut," No appointments found for this client. ")):c("",!0),(n(!0),o(E,null,T($.value,s=>{var f,z;return n(),o("div",{key:s.id,class:"card card-compact"},[e("div",mt,[e("div",pt,[e("div",null,[e("div",vt,a(r(D)(r(B)(s.start_time),"EEEE, MMM d, yyyy")),1),e("div",ht,a(r(D)(r(B)(s.start_time),"h:mm a"))+" with "+a((f=s.barber)==null?void 0:f.name),1)]),e("div",{class:ve(["badge",ee(s.status)])},a(s.status),3)]),e("div",ft,[(z=s.services)!=null&&z.length?(n(),o("div",_t,[u(r(ke),{class:"w-4 h-4 text-slate-400"}),e("span",null,a(s.services.map(ie=>{var O;return(O=ie.service)==null?void 0:O.name}).join(", ")),1)])):c("",!0),s.total_amount?(n(),o("div",xt,[u(r(he),{class:"w-4 h-4 text-slate-400"}),e("span",null,"$"+a(s.total_amount),1)])):c("",!0),s.notes?(n(),o("div",bt,[u(r(we),{class:"w-4 h-4 text-slate-400 mt-0.5"}),e("span",gt,a(s.notes),1)])):c("",!0)])])])}),128))])])]),_:1},8,["is-open","title"])):c("",!0)]))}});export{jt as default};
