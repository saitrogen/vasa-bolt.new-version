import{c as o,a as e,o as n,d as ie,i as d,r as re,h as f,K as de,n as ce,p as u,z as ue,f as c,b as g,e as r,v as w,F as T,q as D,t as a,g as Z,B as K,s as M,H as me,w as Q,y as pe,k as ve}from"./index-xkOOj8vl.js";import{_ as G}from"./Modal.vue_vue_type_script_setup_true_lang-Dp5sxbA3.js";import{r as he}from"./PlusIcon-DaUhA_JQ.js";import{r as _e,a as xe}from"./ChevronRightIcon-C4YS7kmK.js";import{r as fe}from"./PencilSquareIcon-89d4YGpt.js";import{f as B,p as U}from"./parseISO-Crjmnvoz.js";function be(V,m){return n(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M20.25 8.511c.884.284 1.5 1.128 1.5 2.097v4.286c0 1.136-.847 2.1-1.98 2.193-.34.027-.68.052-1.02.072v3.091l-3-3c-1.354 0-2.694-.055-4.02-.163a2.115 2.115 0 0 1-.825-.242m9.345-8.334a2.126 2.126 0 0 0-.476-.095 48.64 48.64 0 0 0-8.048 0c-1.131.094-1.976 1.057-1.976 2.192v4.286c0 .837.46 1.58 1.155 1.951m9.345-8.334V6.637c0-1.621-1.152-3.026-2.76-3.235A48.455 48.455 0 0 0 11.25 3c-2.115 0-4.198.137-6.24.402-1.608.209-2.76 1.614-2.76 3.235v6.226c0 1.621 1.152 3.026 2.76 3.235.577.075 1.157.14 1.74.194V21l4.155-4.155"})])}function ge(V,m){return n(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})])}function we(V,m){return n(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9.568 3H5.25A2.25 2.25 0 0 0 3 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 0 0 5.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 0 0 9.568 3Z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 6h.008v.008H6V6Z"})])}const ye={class:"space-y-6"},ke={class:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4"},Ce={class:"flex items-center gap-2"},Me={class:"relative w-full md:w-64"},Ve={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},je={class:"card overflow-hidden"},Ne={class:"overflow-x-auto"},$e={class:"min-w-full divide-y divide-slate-200 dark:divide-slate-700"},Ae={class:"divide-y divide-slate-200 dark:divide-slate-700 bg-white dark:bg-slate-900"},Ee={key:1},Te={class:"text-center py-10",colspan:"5"},De={class:"text-center text-slate-500"},Be={key:0,class:"text-sm"},Ue=["onClick"],Se={class:"px-6 py-4 whitespace-nowrap"},Fe={class:"flex items-center"},Le={class:"flex-shrink-0 h-10 w-10"},Pe={class:"h-10 w-10 rounded-full bg-slate-200 dark:bg-slate-700 flex items-center justify-center font-bold text-slate-600 dark:text-slate-300"},He={class:"ml-4"},qe={class:"text-sm font-medium text-slate-900 dark:text-slate-100"},Ie={class:"text-sm text-slate-500 dark:text-slate-400 lg:hidden"},ze={class:"px-6 py-4 whitespace-nowrap hidden sm:table-cell"},Oe={class:"text-sm text-slate-900 dark:text-slate-100"},Ze={class:"text-sm text-slate-500 dark:text-slate-400"},Ke={class:"px-6 py-4 whitespace-nowrap text-center hidden md:table-cell"},Qe={class:"text-sm text-slate-500 dark:text-slate-400"},Ge={key:0,class:"ml-2 badge badge-success"},Je={class:"px-6 py-4 whitespace-nowrap text-sm text-slate-500 dark:text-slate-400 hidden lg:table-cell"},Re={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},We=["onClick"],Xe={key:0,class:"card-footer flex items-center justify-between"},Ye={class:"text-sm text-slate-600 dark:text-slate-400"},et={class:"flex items-center gap-1"},tt=["disabled"],st=["disabled"],lt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},at={class:"flex justify-end gap-3 pt-4"},nt=["disabled"],ot={class:"space-y-4"},it={class:"text-sm text-slate-500 dark:text-slate-400"},rt={class:"space-y-3 max-h-[60vh] overflow-y-auto -m-3 p-3 pretty-scrollbar"},dt={key:0,class:"text-center py-10 text-slate-500"},ct={class:"card-body"},ut={class:"flex items-start justify-between"},mt={class:"font-medium text-slate-800 dark:text-slate-200"},pt={class:"text-sm text-slate-500 dark:text-slate-400"},vt={class:"mt-2 text-sm text-slate-600 dark:text-slate-300 space-y-1"},ht={key:0,class:"flex items-center gap-2"},_t={key:1,class:"flex items-center gap-2"},xt={key:2,class:"pt-1 flex items-start gap-2"},ft={class:"italic"},S=10,Mt=ie({__name:"Clients",setup(V){const{addToast:m}=me(),j=d([]),b=d([]),y=d(!0),k=d(!1),h=d(""),p=d(1),C=d(!1),v=d(null),N=d(!1),_=d(null),i=re({name:"",phone_number:"",email:"",notes:""}),F=f(()=>{if(!h.value)return j.value;const l=h.value.toLowerCase();return j.value.filter(t=>t.name.toLowerCase().includes(l)||t.phone_number&&t.phone_number.includes(l)||t.email&&t.email.toLowerCase().includes(l))}),$=f(()=>Math.ceil(F.value.length/S)),L=f(()=>(p.value-1)*S),J=f(()=>L.value+S),P=f(()=>F.value.slice(L.value,J.value)),A=f(()=>_.value?b.value.filter(l=>l.client_id===_.value.id).sort((l,t)=>new Date(t.start_time).getTime()-new Date(l.start_time).getTime()):[]),R=l=>l.split(" ").map(t=>t[0]).join("").toUpperCase().slice(0,2),W=l=>b.value.filter(t=>t.client_id===l).length,H=l=>{const t=new Date;return b.value.filter(s=>s.client_id===l&&new Date(s.start_time)>t&&s.status!=="cancelled").length},X=l=>{const t=b.value.filter(s=>s.client_id===l&&s.status==="completed").sort((s,x)=>new Date(x.start_time).getTime()-new Date(s.start_time).getTime());return t.length===0?"Never":B(U(t[0].start_time),"MMM d, yyyy")},Y=l=>({scheduled:"badge-info",completed:"badge-success",cancelled:"badge-error","no-show":"badge-warning"})[l]||"badge-default",q=()=>{Object.assign(i,{name:"",phone_number:"",email:"",notes:""})},ee=()=>{v.value=null,q(),C.value=!0},te=l=>{v.value=l,Object.assign(i,{name:l.name,phone_number:l.phone_number||"",email:l.email||"",notes:l.notes||""}),C.value=!0},E=()=>{C.value=!1,v.value=null,q()},se=l=>{_.value=l,N.value=!0},le=()=>{N.value=!1,_.value=null},ae=async()=>{if(!i.name.trim()){m({type:"error",title:"Validation Error",message:"Client name is required"});return}k.value=!0;try{const l={name:i.name.trim(),phone_number:i.phone_number.trim()||null,email:i.email.trim()||null,notes:i.notes.trim()||null};if(v.value){const{error:t}=await M.from("clients").update(l).eq("id",v.value.id);if(t)throw t;m({type:"success",title:"Success",message:"Client updated successfully"})}else{const{error:t}=await M.from("clients").insert(l);if(t)throw t;m({type:"success",title:"Success",message:"Client created successfully"})}E(),await I()}catch(l){m({type:"error",title:"Error",message:l.message||"Failed to save client"})}finally{k.value=!1}},I=async()=>{y.value=!0;try{const{data:l,error:t}=await M.from("clients").select("*").order("name");if(t)throw t;j.value=l||[]}catch{m({type:"error",title:"Error",message:"Failed to fetch clients"})}finally{y.value=!1}},ne=async()=>{try{const{data:l,error:t}=await M.from("appointments").select("*, barber:barbers(name), services:appointment_services(service:services(name))");if(t)throw t;b.value=l||[]}catch(l){console.error("Error fetching appointments:",l)}};return de(h,()=>{p.value=1}),ce(async()=>{await I(),await ne()}),(l,t)=>(n(),o("div",ye,[e("div",ke,[t[8]||(t[8]=e("h1",{class:"text-2xl font-bold text-slate-900 dark:text-slate-100"},"Clients",-1)),e("div",Ce,[e("div",Me,[e("div",Ve,[u(r(ge),{class:"h-5 w-5 text-slate-400"})]),g(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>h.value=s),type:"text",placeholder:"Search clients...",class:"input pl-10 w-full"},null,512),[[w,h.value]])]),e("button",{onClick:ee,class:"btn btn-primary"},[u(r(he),{class:"w-4 h-4 md:mr-2"}),t[7]||(t[7]=e("span",{class:"hidden md:inline"},"New Client",-1))])])]),e("div",je,[e("div",Ne,[e("table",$e,[t[12]||(t[12]=e("thead",{class:"bg-slate-50 dark:bg-slate-800"},[e("tr",null,[e("th",{scope:"col",class:"table-header px-6 py-3 text-left"},"Client"),e("th",{scope:"col",class:"table-header px-6 py-3 text-left hidden sm:table-cell"},"Contact"),e("th",{scope:"col",class:"table-header px-6 py-3 text-center hidden md:table-cell"},"Appointments"),e("th",{scope:"col",class:"table-header px-6 py-3 text-left hidden lg:table-cell"},"Last Visit"),e("th",{scope:"col",class:"table-header px-6 py-3 text-right"},"Actions")])],-1)),e("tbody",Ae,[y.value?(n(),o(T,{key:0},D(5,s=>e("tr",{key:s},t[9]||(t[9]=[e("td",{class:"px-6 py-4 whitespace-nowrap",colspan:"5"},[e("div",{class:"animate-pulse flex space-x-4"},[e("div",{class:"rounded-full bg-slate-200 dark:bg-slate-700 h-10 w-10"}),e("div",{class:"flex-1 space-y-2 py-1"},[e("div",{class:"h-2 bg-slate-200 dark:bg-slate-700 rounded"}),e("div",{class:"h-2 bg-slate-200 dark:bg-slate-700 rounded w-5/6"})])])],-1)]))),64)):c("",!0),!y.value&&P.value.length===0?(n(),o("tr",Ee,[e("td",Te,[e("div",De,[t[10]||(t[10]=e("p",{class:"font-medium"},"No clients found",-1)),h.value?(n(),o("p",Be,"Try adjusting your search.")):c("",!0)])])])):c("",!0),(n(!0),o(T,null,D(P.value,s=>(n(),o("tr",{key:s.id,class:"hover:bg-slate-50 dark:hover:bg-slate-800/50 cursor-pointer",onClick:x=>se(s)},[e("td",Se,[e("div",Fe,[e("div",Le,[e("div",Pe,a(R(s.name)),1)]),e("div",He,[e("div",qe,a(s.name),1),e("div",Ie,a(s.email||s.phone_number),1)])])]),e("td",ze,[e("div",Oe,a(s.email),1),e("div",Ze,a(s.phone_number),1)]),e("td",Ke,[e("span",Qe,a(W(s.id))+" Total",1),H(s.id)>0?(n(),o("span",Ge,a(H(s.id))+" Upcoming",1)):c("",!0)]),e("td",Je,a(X(s.id)),1),e("td",Re,[e("button",{onClick:Q(x=>te(s),["stop"]),class:"btn btn-sm btn-ghost"},[u(r(fe),{class:"w-5 h-5"}),t[11]||(t[11]=e("span",{class:"sr-only"},"Edit",-1))],8,We)])],8,Ue))),128))])])]),$.value>1?(n(),o("div",Xe,[e("div",Ye," Page "+a(p.value)+" of "+a($.value),1),e("div",et,[e("button",{onClick:t[1]||(t[1]=s=>p.value--),disabled:p.value===1,class:"btn btn-sm btn-outline"},[u(r(_e),{class:"h-4 w-4"}),t[13]||(t[13]=Z(" Previous "))],8,tt),e("button",{onClick:t[2]||(t[2]=s=>p.value++),disabled:p.value>=$.value,class:"btn btn-sm btn-outline"},[t[14]||(t[14]=Z(" Next ")),u(r(xe),{class:"h-4 w-4"})],8,st)])])):c("",!0)]),u(G,{"is-open":C.value,title:v.value?"Edit Client":"Add New Client",onClose:E},{default:K(()=>[e("form",{onSubmit:Q(ae,["prevent"]),class:"space-y-4"},[e("div",null,[t[15]||(t[15]=e("label",{class:"label"},"Full Name *",-1)),g(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>i.name=s),type:"text",required:"",class:"input",placeholder:"Enter client's full name"},null,512),[[w,i.name]])]),e("div",lt,[e("div",null,[t[16]||(t[16]=e("label",{class:"label"},"Phone Number",-1)),g(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>i.phone_number=s),type:"tel",class:"input",placeholder:"(555) 123-4567"},null,512),[[w,i.phone_number]])]),e("div",null,[t[17]||(t[17]=e("label",{class:"label"},"Email Address",-1)),g(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>i.email=s),type:"email",class:"input",placeholder:"client@example.com"},null,512),[[w,i.email]])])]),e("div",null,[t[18]||(t[18]=e("label",{class:"label"},"Notes",-1)),g(e("textarea",{"onUpdate:modelValue":t[6]||(t[6]=s=>i.notes=s),rows:"4",class:"textarea",placeholder:"Any preferences, allergies, or other notes..."},null,512),[[w,i.notes]])]),e("div",at,[e("button",{type:"button",onClick:E,class:"btn btn-secondary"}," Cancel "),e("button",{type:"submit",disabled:k.value,class:"btn btn-primary"},a(k.value?"Saving...":v.value?"Update Client":"Create Client"),9,nt)])],32)]),_:1},8,["is-open","title"]),_.value?(n(),ue(G,{key:0,"is-open":N.value,title:`${_.value.name}`,size:"lg",onClose:le},{default:K(()=>[e("div",ot,[e("div",it," Total appointments: "+a(A.value.length),1),e("div",rt,[A.value.length===0?(n(),o("div",dt," No appointments found for this client. ")):c("",!0),(n(!0),o(T,null,D(A.value,s=>{var x,z;return n(),o("div",{key:s.id,class:"card card-compact"},[e("div",ct,[e("div",ut,[e("div",null,[e("div",mt,a(r(B)(r(U)(s.start_time),"EEEE, MMM d, yyyy")),1),e("div",pt,a(r(B)(r(U)(s.start_time),"h:mm a"))+" with "+a((x=s.barber)==null?void 0:x.name),1)]),e("div",{class:pe(["badge",Y(s.status)])},a(s.status),3)]),e("div",vt,[(z=s.services)!=null&&z.length?(n(),o("div",ht,[u(r(we),{class:"w-4 h-4 text-slate-400"}),e("span",null,a(s.services.map(oe=>{var O;return(O=oe.service)==null?void 0:O.name}).join(", ")),1)])):c("",!0),s.total_amount?(n(),o("div",_t,[u(r(ve),{class:"w-4 h-4 text-slate-400"}),e("span",null,"$"+a(s.total_amount),1)])):c("",!0),s.notes?(n(),o("div",xt,[u(r(be),{class:"w-4 h-4 text-slate-400 mt-0.5"}),e("span",ft,a(s.notes),1)])):c("",!0)])])])}),128))])])]),_:1},8,["is-open","title"])):c("",!0)]))}});export{Mt as default};
