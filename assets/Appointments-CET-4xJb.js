import{d as oe,i as C,D as de,h as L,c as o,a as e,F as _,q as y,p as q,e as S,t as p,b as M,E as Y,y as $,w as G,G as ue,f as ee,o as l,r as ce,n as me,B as pe,s as O,H as ve,v as R,I as z,J as be}from"./index-D64xMZbU.js";import{t as B,c as le,s as ae,f as w,a as Z,p as j}from"./parseISO-Crjmnvoz.js";import{e as re,s as xe,a as ke,b as ge,c as _e}from"./subMonths-DmONsWOi.js";import{r as ye,a as fe}from"./ChevronRightIcon-SnC8QGCC.js";import{_ as he}from"./Modal.vue_vue_type_script_setup_true_lang-DGmq4bL9.js";import{r as we}from"./PlusIcon-BFJiKygd.js";function J(v,x){const k=B(v);return isNaN(x)?le(v,NaN):(x&&k.setDate(k.getDate()+x),k)}function ie(v,x){const k=x*7;return J(v,k)}function Me(v){return le(v,Date.now())}function te(v,x){const k=ae(v),g=ae(x);return+k==+g}function ne(v,x){const k=B(v.start),g=B(v.end);let i=+k>+g;const f=i?+k:+g,h=i?g:k;h.setHours(0,0,0,0);let T=1;const D=[];for(;+h<=f;)D.push(B(h)),h.setDate(h.getDate()+T),h.setHours(0,0,0,0);return i?D.reverse():D}function De(v,x){const k=B(v),g=B(x);return k.getFullYear()===g.getFullYear()&&k.getMonth()===g.getMonth()}function $e(v){return te(v,Me(v))}function Se(v,x){return J(v,-1)}function Ce(v,x){return ie(v,-1)}const Te={class:"card"},Ae={class:"p-4 md:p-6 border-b border-slate-200/80 dark:border-slate-800"},Ee={class:"flex flex-col lg:flex-row lg:items-center justify-between space-y-4 lg:space-y-0"},Oe={class:"flex items-center space-x-4 md:space-x-6"},Ne={class:"flex items-center bg-slate-100 dark:bg-slate-800 p-1 rounded-lg"},Ve=["onClick"],He={class:"flex items-center justify-between lg:justify-end space-x-2 md:space-x-3"},Be={class:"flex items-center space-x-1"},Ie={class:"text-base md:text-lg font-medium text-slate-900 dark:text-slate-100 text-center"},Fe={class:"p-2 md:p-6"},Ue={key:0,class:"overflow-x-auto"},je={class:"space-y-6 min-w-[800px]"},qe={class:"grid grid-cols-8 gap-6"},Pe={class:"text-sm font-medium text-slate-700 dark:text-slate-300"},We={class:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-1"},Le={class:"grid grid-cols-8 gap-6"},Re={class:"space-y-6"},ze=["onClick"],Ye=["onClick"],Ge={class:"font-medium truncate"},Je={class:"text-xs opacity-75 truncate"},Ke={key:1,class:"space-y-4"},Qe={class:"flex items-center justify-between"},Xe={class:"text-lg font-medium text-slate-900 dark:text-slate-100"},Ze=["value"],et={class:"grid grid-cols-1 gap-2 max-h-96 overflow-y-auto"},tt=["onClick"],st={class:"w-16 text-sm text-slate-500 dark:text-slate-400"},at={class:"flex-1 grid grid-cols-3 gap-2"},rt=["onClick"],nt={class:"font-medium"},ot={class:"text-sm opacity-75"},lt={class:"text-xs opacity-75"},it={key:2,class:"grid grid-cols-7 gap-1"},dt={class:"hidden md:inline"},ut={class:"md:hidden"},ct=["onClick"],mt={class:"flex items-center justify-between"},pt={class:"text-xs text-slate-400 dark:text-slate-500"},vt={class:"mt-1 space-y-1"},bt=["onClick"],xt={key:0,class:"text-xs text-slate-500 dark:text-slate-400"},kt=oe({__name:"AppointmentCalendar",props:{appointments:{},barbers:{},loading:{type:Boolean,default:!1}},emits:["new-appointment","edit-appointment","date-change"],setup(v,{emit:x}){const k=v,g=x,i=C(new Date),f=C("week"),h=C(""),{width:T}=de(),D=[{label:"Day",value:"day"},{label:"Week",value:"week"},{label:"Month",value:"month"}],V=Array.from({length:12},(d,n)=>n+9),s=L(()=>{const d=T.value<768;switch(f.value){case"day":return w(i.value,"MMM d, yyyy");case"week":const n=Z(i.value),a=re(i.value);return d?`${w(n,"MMM d")} - ${w(a,"d")}`:`${w(n,"MMM d")} - ${w(a,"MMM d, yyyy")}`;case"month":return w(i.value,"MMMM yyyy");default:return""}}),I=L(()=>{const d=Z(i.value);return ne({start:d,end:J(d,6)}).map(n=>({date:n}))}),K=L(()=>{const d=xe(i.value),n=ke(i.value),a=Z(d),c=re(n);return ne({start:a,end:c}).map(u=>({date:u,isCurrentMonth:De(u,i.value),isToday:$e(u)}))}),F=L(()=>{let d=k.appointments;return h.value&&(d=d.filter(n=>n.barber_id===h.value)),d}),H=(d,n)=>F.value.filter(a=>{const c=j(a.start_time);return te(c,d)&&c.getHours()===n}),E=d=>F.value.filter(n=>{const a=j(n.start_time);return te(a,d)}),U=d=>{const n={booked:"bg-blue-100 text-blue-800 border-blue-200 dark:bg-blue-500/10 dark:text-blue-300 dark:border-blue-500/20",confirmed:"bg-green-100 text-green-800 border-green-200 dark:bg-green-500/10 dark:text-green-300 dark:border-green-500/20",completed:"bg-slate-100 text-slate-800 border-slate-200 dark:bg-slate-700/50 dark:text-slate-300 dark:border-slate-600/50",cancelled:"bg-red-100 text-red-800 border-red-200 dark:bg-red-500/10 dark:text-red-300 dark:border-red-500/20","no-show":"bg-yellow-100 text-yellow-800 border-yellow-200 dark:bg-yellow-500/10 dark:text-yellow-300 dark:border-yellow-500/20"};return n[d]||n.booked},Q=d=>{const n=j(d.start_time),c=(j(d.end_time).getTime()-n.getTime())/(1e3*60);return{height:`${Math.min(c/60*100,100)}%`,top:"0%"}},P=d=>{const n=new Date;return n.setHours(d,0,0,0),w(n,"h:mm a")},m=()=>{switch(f.value){case"day":i.value=Se(i.value);break;case"week":i.value=Ce(i.value);break;case"month":i.value=ge(i.value);break}g("date-change",i.value)},t=()=>{switch(f.value){case"day":i.value=J(i.value,1);break;case"week":i.value=ie(i.value,1);break;case"month":i.value=_e(i.value,1);break}g("date-change",i.value)},r=()=>{i.value=new Date,g("date-change",i.value)},A=d=>{i.value=d,f.value="day",g("date-change",d)},W=(d,n)=>{g("new-appointment",d,n)};return(d,n)=>(l(),o("div",Te,[e("div",Ae,[e("div",Ee,[e("div",Oe,[n[1]||(n[1]=e("h2",{class:"text-lg font-semibold text-slate-900 dark:text-slate-100 flex-shrink-0"},"Appointments",-1)),e("div",Ne,[(l(),o(_,null,y(D,a=>e("button",{key:a.value,onClick:c=>f.value=a.value,class:$(["px-3 md:px-4 py-1.5 rounded-md text-sm font-medium transition-all duration-200",f.value===a.value?"bg-white dark:bg-slate-700 text-primary-700 dark:text-primary-200 shadow-sm":"text-slate-600 dark:text-slate-300 hover:text-slate-900 dark:hover:text-slate-100"])},p(a.label),11,Ve)),64))])]),e("div",He,[e("div",Be,[e("button",{onClick:m,class:"p-2 text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200 rounded-md hover:bg-slate-100 dark:hover:bg-slate-700"},[q(S(ye),{class:"w-5 h-5"})]),e("button",{onClick:t,class:"p-2 text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200 rounded-md hover:bg-slate-100 dark:hover:bg-slate-700"},[q(S(fe),{class:"w-5 h-5"})])]),e("div",Ie,p(s.value),1),e("div",{class:"flex items-center space-x-2 md:space-x-3"},[e("button",{onClick:r,class:"btn btn-outline"}," Today ")])])])]),e("div",Fe,[f.value==="week"?(l(),o("div",Ue,[e("div",je,[e("div",qe,[n[2]||(n[2]=e("div",{class:"text-sm font-medium text-slate-500 dark:text-slate-400"},"Time",-1)),(l(!0),o(_,null,y(I.value,a=>(l(),o("div",{key:a.date.toISOString(),class:"text-center"},[e("div",Pe,p(S(w)(a.date,"EEE")),1),e("div",We,p(S(w)(a.date,"d")),1)]))),128))]),e("div",Le,[e("div",Re,[(l(!0),o(_,null,y(S(V),a=>(l(),o("div",{key:a,class:"h-20 flex items-center text-sm text-slate-600 dark:text-slate-400 border-r border-slate-100 dark:border-slate-800 pr-3 font-medium"},p(P(a)),1))),128))]),(l(!0),o(_,null,y(I.value,a=>(l(),o("div",{key:a.date.toISOString(),class:"space-y-1"},[(l(!0),o(_,null,y(S(V),c=>(l(),o("div",{key:`${a.date}-${c}`,class:"h-20 border border-slate-100 dark:border-slate-800 rounded-md p-1 hover:bg-slate-50 dark:hover:bg-slate-800/50 cursor-pointer relative",onClick:u=>W(a.date,c)},[(l(!0),o(_,null,y(H(a.date,c),u=>{var b,N;return l(),o("div",{key:u.id,class:$(["absolute inset-x-1 rounded-md p-1 text-xs cursor-pointer","hover:shadow-md transition-shadow",U(u.status)]),style:ue(Q(u)),onClick:G(X=>d.$emit("edit-appointment",u),["stop"])},[e("div",Ge,p((b=u.client)==null?void 0:b.name),1),e("div",Je,p((N=u.barber)==null?void 0:N.name),1)],14,Ye)}),128))],8,ze))),128))]))),128))])])])):f.value==="day"?(l(),o("div",Ke,[e("div",Qe,[e("h3",Xe,p(S(w)(i.value,"EEEE, MMMM d, yyyy")),1),M(e("select",{"onUpdate:modelValue":n[0]||(n[0]=a=>h.value=a),class:"select"},[n[3]||(n[3]=e("option",{value:""},"All Barbers",-1)),(l(!0),o(_,null,y(d.barbers,a=>(l(),o("option",{key:a.id,value:a.id},p(a.name),9,Ze))),128))],512),[[Y,h.value]])]),e("div",et,[(l(!0),o(_,null,y(S(V),a=>(l(),o("div",{key:a,class:"flex items-center space-x-4 p-2 border border-slate-100 dark:border-slate-800 rounded-md hover:bg-slate-50 dark:hover:bg-slate-800/50 cursor-pointer",onClick:c=>W(i.value,a)},[e("div",st,p(P(a)),1),e("div",at,[(l(!0),o(_,null,y(H(i.value,a),c=>{var u,b,N;return l(),o("div",{key:c.id,class:$(["p-2 rounded-md cursor-pointer hover:shadow-md transition-shadow",U(c.status)]),onClick:G(X=>d.$emit("edit-appointment",c),["stop"])},[e("div",nt,p((u=c.client)==null?void 0:u.name),1),e("div",ot,p((b=c.barber)==null?void 0:b.name),1),e("div",lt,p((N=c.services)==null?void 0:N.map(X=>{var se;return(se=X.service)==null?void 0:se.name}).join(", ")),1)],10,rt)}),128))])],8,tt))),128))])])):(l(),o("div",it,[(l(),o(_,null,y(["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],a=>e("div",{key:a,class:"p-2 text-center text-xs md:text-sm font-medium text-slate-500 dark:text-slate-400 border-b border-slate-200 dark:border-slate-800"},[e("span",dt,p(a),1),e("span",ut,p(a.charAt(0)),1)])),64)),(l(!0),o(_,null,y(K.value,a=>(l(),o("div",{key:a.date.toISOString(),class:$(["min-h-[100px] p-1 border border-slate-100 dark:border-slate-800 hover:bg-slate-50 dark:hover:bg-slate-800/50 cursor-pointer",a.isCurrentMonth?"bg-white dark:bg-slate-900":"bg-slate-50 dark:bg-slate-800/50",a.isToday?"bg-primary-50 dark:bg-primary-900/30 border-primary-200 dark:border-primary-500/50":""]),onClick:c=>A(a.date)},[e("div",mt,[e("span",{class:$(["text-sm font-medium",a.isCurrentMonth?"text-slate-900 dark:text-slate-100":"text-slate-400 dark:text-slate-500",a.isToday?"text-primary-600 dark:text-primary-300":""])},p(S(w)(a.date,"d")),3),e("span",pt,p(E(a.date).length),1)]),e("div",vt,[(l(!0),o(_,null,y(E(a.date).slice(0,3),c=>{var u;return l(),o("div",{key:c.id,class:$(["text-xs p-1 rounded truncate cursor-pointer",U(c.status)]),onClick:G(b=>d.$emit("edit-appointment",c),["stop"])},p((u=c.client)==null?void 0:u.name),11,bt)}),128)),E(a.date).length>3?(l(),o("div",xt," +"+p(E(a.date).length-3)+" more ",1)):ee("",!0)])],10,ct))),128))]))])]))}}),gt={class:"space-y-6"},_t={class:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4"},yt={class:"flex border-b border-slate-200 dark:border-slate-700"},ft=["onClick"],ht={class:"space-y-4"},wt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Mt=["value"],Dt=["value"],$t={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},St={class:"max-h-60 overflow-y-auto -m-2 p-2 space-y-1 mt-1 pretty-scrollbar"},Ct=["value"],Tt={key:0},At={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Et={key:0},Ft=oe({__name:"Appointments",setup(v){const{addToast:x}=ve(),k=C([]),g=C([]),i=C([]),f=C([]),h=C(!1),T=C(null),D=C("details"),V=[{id:"details",name:"Details"},{id:"services",name:"Services"},{id:"notes",name:"Notes"}];T.value&&V.push({id:"status",name:"Status"});const s=ce({id:null,client_id:"",barber_id:"",date:"",time:"",service_ids:[],notes:"",status:"scheduled",total_amount:0}),I=async()=>{const{data:m,error:t}=await O.from("appointments").select("*, client:clients(name), barber:barbers(name), services:appointment_services(service_id)").order("start_time",{ascending:!0});t?x({type:"error",title:"Error fetching appointments",message:t.message}):k.value=m||[]},K=async()=>{const{data:m}=await O.from("barbers").select("*");m&&(g.value=m);const{data:t}=await O.from("clients").select("*");t&&(i.value=t);const{data:r}=await O.from("services").select("*");r&&(f.value=r)},F=()=>{s.id=null,s.client_id="",s.barber_id="",s.date=new Date().toISOString().split("T")[0],s.time="",s.service_ids=[],s.notes="",s.status="scheduled",s.total_amount=0},H=m=>{var t;if(T.value=m,m){const r=j(m.start_time);s.id=m.id,s.client_id=m.client_id,s.barber_id=m.barber_id,s.date=w(r,"yyyy-MM-dd"),s.time=w(r,"HH:mm"),s.service_ids=((t=m.services)==null?void 0:t.map(A=>A.service_id))||[],s.notes=m.notes||"",s.status=m.status,s.total_amount=m.total_amount||0}else F();h.value=!0},E=()=>{h.value=!1,T.value=null,F()},U=async()=>{const m=f.value.filter(u=>s.service_ids.includes(u.id)),t=m.reduce((u,b)=>u+b.duration_minutes,0),r=m.reduce((u,b)=>u+b.price,0),A=new Date(`${s.date}T${s.time}`),W=new Date(A.getTime()+t*6e4);if(s.service_ids.length===0){x({type:"error",title:"No services selected",message:"Please select at least one service."});return}const d={client_id:s.client_id,barber_id:s.barber_id,start_time:A.toISOString(),end_time:W.toISOString(),status:s.status,notes:s.notes,total_amount:s.status==="completed"?s.total_amount:r};let n;if(s.id){const{data:u,error:b}=await O.from("appointments").update(d).eq("id",s.id).select().single();if(b){x({type:"error",title:"Error",message:b.message});return}n=u}else{const{data:u,error:b}=await O.from("appointments").insert(d).select().single();if(b){x({type:"error",title:"Error",message:b.message});return}n=u}const{error:a}=await O.from("appointment_services").delete().eq("appointment_id",n.id);if(a){x({type:"error",title:"Error",message:a.message});return}const c=s.service_ids.map(u=>{const b=f.value.find(N=>N.id===u);return{appointment_id:n.id,service_id:u,price_at_booking:(b==null?void 0:b.price)||0,duration_at_booking:(b==null?void 0:b.duration_minutes)||0,quantity:1}});if(c.length>0){const{error:u}=await O.from("appointment_services").insert(c);if(u){x({type:"error",title:"Error",message:u.message});return}}x({type:"success",title:"Success",message:"Appointment saved!"}),E(),I()},Q=(m,t)=>{if(H(null),m&&(s.date=w(m,"yyyy-MM-dd"),t)){const r=new Date;r.setHours(t,0,0,0),s.time=w(r,"HH:mm")}},P=m=>{H(m)};return me(()=>{I(),K()}),(m,t)=>(l(),o("div",gt,[e("div",_t,[t[10]||(t[10]=e("h1",{class:"text-2xl font-bold text-slate-900 dark:text-slate-100"},"Appointments",-1)),e("button",{onClick:t[0]||(t[0]=r=>H(null)),class:"btn btn-primary"},[q(S(we),{class:"w-4 h-4 md:mr-2"}),t[9]||(t[9]=e("span",{class:"hidden md:inline"},"New Appointment",-1))])]),q(kt,{appointments:k.value,barbers:g.value,onNewAppointment:Q,onEditAppointment:P},null,8,["appointments","barbers"]),q(he,{"is-open":h.value,onClose:E,title:T.value?"Edit Appointment":"New Appointment"},{default:pe(()=>[e("div",yt,[(l(),o(_,null,y(V,r=>e("button",{key:r.id,onClick:A=>D.value=r.id,class:$(["px-4 py-2 text-sm font-medium transition-colors",D.value===r.id?"border-b-2 border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200"])},p(r.name),11,ft)),64))]),e("form",{onSubmit:G(U,["prevent"]),class:"py-6 space-y-6"},[M(e("div",ht,[e("div",wt,[e("div",null,[t[12]||(t[12]=e("label",{class:"label"},"Client",-1)),M(e("select",{"onUpdate:modelValue":t[1]||(t[1]=r=>s.client_id=r),required:"",class:"select"},[t[11]||(t[11]=e("option",{disabled:"",value:""},"Select Client",-1)),(l(!0),o(_,null,y(i.value,r=>(l(),o("option",{key:r.id,value:r.id},p(r.name),9,Mt))),128))],512),[[Y,s.client_id]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"label"},"Barber",-1)),M(e("select",{"onUpdate:modelValue":t[2]||(t[2]=r=>s.barber_id=r),required:"",class:"select"},[t[13]||(t[13]=e("option",{disabled:"",value:""},"Select Barber",-1)),(l(!0),o(_,null,y(g.value,r=>(l(),o("option",{key:r.id,value:r.id},p(r.name),9,Dt))),128))],512),[[Y,s.barber_id]])])]),e("div",$t,[e("div",null,[t[15]||(t[15]=e("label",{class:"label"},"Date",-1)),M(e("input",{"onUpdate:modelValue":t[3]||(t[3]=r=>s.date=r),type:"date",required:"",class:"input"},null,512),[[R,s.date]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"label"},"Time",-1)),M(e("input",{"onUpdate:modelValue":t[4]||(t[4]=r=>s.time=r),type:"time",required:"",class:"input"},null,512),[[R,s.time]])])])],512),[[z,D.value==="details"]]),M(e("div",null,[t[17]||(t[17]=e("label",{class:"label"},"Services",-1)),e("div",St,[(l(!0),o(_,null,y(f.value,r=>(l(),o("label",{key:r.id,class:$(["flex items-center space-x-3 p-2 rounded-md cursor-pointer transition-colors",s.service_ids.includes(r.id)?"bg-primary-50 dark:bg-primary-500/10":"hover:bg-slate-100 dark:hover:bg-slate-800"])},[M(e("input",{type:"checkbox",value:r.id,"onUpdate:modelValue":t[5]||(t[5]=A=>s.service_ids=A),class:"checkbox"},null,8,Ct),[[be,s.service_ids]]),e("span",{class:$(["font-medium",s.service_ids.includes(r.id)?"text-primary-800 dark:text-primary-200":"text-slate-800 dark:text-slate-200"])},p(r.name),3),e("span",{class:$(["ml-auto text-sm",[s.service_ids.includes(r.id)?"text-primary-600 dark:text-primary-400":"text-slate-500 dark:text-slate-400"]])},"$"+p(r.price),3),e("span",{class:$(["text-xs",[s.service_ids.includes(r.id)?"text-primary-500 dark:text-primary-400/80":"text-slate-400 dark:text-slate-500"]])},"("+p(r.duration_minutes)+" min)",3)],2))),128))])],512),[[z,D.value==="services"]]),M(e("div",null,[e("div",null,[t[18]||(t[18]=e("label",{class:"label"},"Notes",-1)),M(e("textarea",{"onUpdate:modelValue":t[6]||(t[6]=r=>s.notes=r),rows:"3",class:"textarea",placeholder:"Optional notes about the appointment"},null,512),[[R,s.notes]])])],512),[[z,D.value==="notes"]]),T.value?M((l(),o("div",Tt,[e("div",At,[e("div",null,[t[20]||(t[20]=e("label",{class:"label"},"Status",-1)),M(e("select",{"onUpdate:modelValue":t[7]||(t[7]=r=>s.status=r),class:"select"},t[19]||(t[19]=[e("option",{value:"scheduled"},"Scheduled",-1),e("option",{value:"completed"},"Completed",-1),e("option",{value:"cancelled"},"Cancelled",-1),e("option",{value:"no-show"},"No-Show",-1)]),512),[[Y,s.status]])]),s.status==="completed"?(l(),o("div",Et,[t[21]||(t[21]=e("label",{class:"label"},"Total Amount",-1)),M(e("input",{"onUpdate:modelValue":t[8]||(t[8]=r=>s.total_amount=r),type:"number",step:"0.01",min:"0",class:"input",placeholder:"Enter final amount"},null,512),[[R,s.total_amount,void 0,{number:!0}]])])):ee("",!0)])],512)),[[z,D.value==="status"]]):ee("",!0),e("div",{class:"flex justify-end gap-3 pt-6 border-t border-slate-200 dark:border-slate-700"},[e("button",{type:"button",onClick:E,class:"btn btn-secondary"}," Cancel "),t[22]||(t[22]=e("button",{type:"submit",class:"btn btn-primary"}," Save Appointment ",-1))])],32)]),_:1},8,["is-open","title"])]))}});export{Ft as default};
