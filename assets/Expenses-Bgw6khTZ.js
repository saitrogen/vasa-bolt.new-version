import{c as i,a as t,o as d,d as ee,i as p,r as L,h as v,K as te,n as se,p as m,e as y,b as x,v as h,E as R,F as D,q as C,t as o,f as S,g as b,B as ae,s as f,H as le,w as oe}from"./index-D64xMZbU.js";import{_ as ne}from"./Modal.vue_vue_type_script_setup_true_lang-DGmq4bL9.js";import{r as re}from"./PlusIcon-BFJiKygd.js";import{r as ie,a as de}from"./ChevronRightIcon-SnC8QGCC.js";import{r as ue}from"./PencilSquareIcon-DWpzx6xj.js";import{f as ce,p as pe}from"./parseISO-Crjmnvoz.js";function me(V,r){return d(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m18.375 12.739-7.693 7.693a4.5 4.5 0 0 1-6.364-6.364l10.94-10.94A3 3 0 1 1 19.5 7.372L8.552 18.32m.009-.01-.01.01m5.699-9.941-7.81 7.81a1.5 1.5 0 0 0 2.112 2.13"})])}function xe(V,r){return d(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})])}const fe={class:"space-y-6"},ge={class:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4"},ve={class:"card p-4"},ye={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},be=["value"],we={class:"mt-4 flex items-center justify-between"},he={class:"text-sm text-gray-600 dark:text-gray-300"},_e={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},ke={class:"card overflow-hidden"},Ee={class:"overflow-x-auto"},De={class:"min-w-full divide-y divide-slate-200 dark:divide-slate-700"},Ce={class:"divide-y divide-slate-200 dark:divide-slate-700 bg-white dark:bg-slate-900"},Se={key:1},$e={class:"px-6 py-4 whitespace-nowrap text-sm text-slate-500 dark:text-slate-400"},Me={class:"px-6 py-4 whitespace-nowrap"},Fe={class:"text-sm font-medium text-slate-900 dark:text-slate-100"},Ue={class:"text-sm text-slate-500 dark:text-slate-400 sm:hidden"},Ie={class:"px-6 py-4 whitespace-nowrap text-sm text-slate-500 dark:text-slate-400 hidden sm:table-cell"},Ne={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium text-slate-800 dark:text-slate-200"},Ve={class:"px-6 py-4 whitespace-nowrap text-center"},Pe=["onClick"],Ae={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},je=["onClick"],qe=["onClick"],Be={key:0,class:"card-footer flex items-center justify-between"},Te={class:"text-sm text-slate-600 dark:text-slate-400"},Oe={class:"font-medium"},Le={class:"font-medium"},Re={class:"font-medium"},Ge={class:"flex items-center gap-1"},He=["disabled"],ze=["disabled"],Je={class:"grid grid-cols-2 gap-4"},Ke=["value"],Qe={class:"relative"},We={class:"flex justify-end gap-3 pt-4"},Xe=["disabled"],N=10,lt=ee({__name:"Expenses",setup(V){const{addToast:r}=le(),P=p([]),_=p(!0),k=p(!1),g=p(1),E=p(!1),u=p(null),$=p(null),A=["Rent","Utilities","Supplies","Equipment","Maintenance","Marketing","Insurance","Professional Services","Other"],n=L({category:"",startDate:"",endDate:""}),l=L({expense_date:new Date().toISOString().substring(0,10),category:"",description:"",amount:0,bill_image_url:""}),c=v(()=>{let a=P.value;return n.category&&(a=a.filter(e=>e.category===n.category)),n.startDate&&(a=a.filter(e=>e.expense_date>=n.startDate)),n.endDate&&(a=a.filter(e=>e.expense_date<=n.endDate)),a.sort((e,s)=>new Date(s.expense_date).getTime()-new Date(e.expense_date).getTime())}),G=v(()=>c.value.reduce((a,e)=>a+e.amount,0)),j=v(()=>Math.ceil(c.value.length/N)),M=v(()=>(g.value-1)*N),q=v(()=>M.value+N),B=v(()=>c.value.slice(M.value,q.value)),H=a=>{if(!a)return"N/A";try{return ce(pe(a),"MMM d, yyyy")}catch{return console.error("Invalid date format:",a),"Invalid Date"}},T=()=>{Object.assign(l,{expense_date:new Date().toISOString().substring(0,10),category:"",description:"",amount:0,bill_image_url:"",is_active:!0})},z=()=>{u.value=null,T(),E.value=!0},J=a=>{u.value=a,Object.assign(l,{expense_date:a.expense_date,category:a.category,description:a.description,amount:a.amount,bill_image_url:a.bill_image_url||""}),E.value=!0},F=()=>{E.value=!1,u.value=null,T(),$.value&&($.value.value="")},K=async a=>{var w;const s=(w=a.target.files)==null?void 0:w[0];if(s){if(s.size>10*1024*1024){r({type:"error",title:"File too large",message:"Please select a file smaller than 10MB"});return}try{const I=`${Date.now()}_${s.name}`,{data:Y,error:O}=await f.storage.from("bills").upload(I,s);if(O)throw O;const{data:{publicUrl:Z}}=f.storage.from("bills").getPublicUrl(Y.path);l.bill_image_url=Z,r({type:"success",title:"Success",message:"Receipt uploaded successfully"})}catch(I){r({type:"error",title:"Upload failed",message:I.message||"Failed to upload receipt"})}}},Q=a=>{window.open(a,"_blank")},W=async()=>{if(!l.expense_date||!l.category||!l.description||l.amount<=0){r({type:"error",title:"Validation Error",message:"Please fill in all required fields with valid values"});return}k.value=!0;try{const a={expense_date:l.expense_date,category:l.category,description:l.description.trim(),amount:l.amount,bill_image_url:l.bill_image_url||null};if(u.value){const{error:e}=await f.from("expenses").update(a).eq("id",u.value.id);if(e)throw e;r({type:"success",title:"Success",message:"Expense updated successfully"})}else{const{error:e}=await f.from("expenses").insert(a);if(e)throw e;r({type:"success",title:"Success",message:"Expense created successfully"})}F(),await U()}catch(a){r({type:"error",title:"Error",message:a.message||"Failed to save expense"})}finally{k.value=!1}},X=async a=>{if(confirm("Are you sure you want to delete this expense?"))try{const{error:e}=await f.from("expenses").delete().eq("id",a.id);if(e)throw e;if(a.bill_image_url){const s=a.bill_image_url.split("/").pop();s&&await f.storage.from("receipts").remove([`expense-receipts/${s}`])}r({type:"success",title:"Success",message:"Expense deleted successfully"}),await U()}catch{r({type:"error",title:"Error",message:"Failed to delete expense"})}},U=async()=>{_.value=!0;try{const{data:a,error:e}=await f.from("expenses").select("*").order("expense_date",{ascending:!1});if(e)throw e;P.value=a||[]}catch{r({type:"error",title:"Error",message:"Failed to fetch expenses"})}finally{_.value=!1}};return te(n,()=>{g.value=1},{deep:!0}),se(()=>{U()}),(a,e)=>(d(),i("div",fe,[t("div",ge,[e[10]||(e[10]=t("h1",{class:"text-2xl font-bold text-slate-900 dark:text-slate-100"},"Expenses",-1)),t("button",{onClick:z,class:"btn btn-primary"},[m(y(re),{class:"w-4 h-4 md:mr-2"}),e[9]||(e[9]=t("span",{class:"hidden md:inline"},"Add Expense",-1))])]),t("div",ve,[t("div",ye,[x(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>n.startDate=s),type:"date",class:"input"},null,512),[[h,n.startDate]]),x(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>n.endDate=s),type:"date",class:"input"},null,512),[[h,n.endDate]]),x(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>n.category=s),class:"select"},[e[11]||(e[11]=t("option",{value:""},"All Categories",-1)),(d(),i(D,null,C(A,s=>t("option",{key:s,value:s},o(s),9,be)),64))],512),[[R,n.category]])]),t("div",we,[t("div",he,o(c.value.length)+" expense"+o(c.value.length!==1?"s":""),1),t("div",_e," Total: $"+o(G.value.toFixed(2)),1)])]),t("div",ke,[t("div",Ee,[t("table",De,[e[16]||(e[16]=t("thead",{class:"bg-slate-50 dark:bg-slate-800"},[t("tr",null,[t("th",{scope:"col",class:"table-header px-6 py-3 text-left"},"Date"),t("th",{scope:"col",class:"table-header px-6 py-3 text-left"},"Expense"),t("th",{scope:"col",class:"table-header px-6 py-3 text-left hidden sm:table-cell"},"Category"),t("th",{scope:"col",class:"table-header px-6 py-3 text-right"},"Amount"),t("th",{scope:"col",class:"table-header px-6 py-3 text-center"},"Receipt"),t("th",{scope:"col",class:"table-header px-6 py-3 text-right"},"Actions")])],-1)),t("tbody",Ce,[_.value?(d(),i(D,{key:0},C(5,s=>t("tr",{key:s},e[12]||(e[12]=[t("td",{class:"px-6 py-4 whitespace-nowrap",colspan:"6"},[t("div",{class:"animate-pulse flex space-x-4"},[t("div",{class:"flex-1 space-y-2 py-1"},[t("div",{class:"h-2 bg-slate-200 dark:bg-slate-700 rounded"}),t("div",{class:"h-2 bg-slate-200 dark:bg-slate-700 rounded w-5/6"})])])],-1)]))),64)):S("",!0),!_.value&&B.value.length===0?(d(),i("tr",Se,e[13]||(e[13]=[t("td",{class:"text-center py-10",colspan:"6"},[t("div",{class:"text-center text-slate-500"},[t("p",{class:"font-medium"},"No expenses found"),t("p",{class:"text-sm"},"Try adjusting your filters.")])],-1)]))):S("",!0),(d(!0),i(D,null,C(B.value,s=>(d(),i("tr",{key:s.id,class:"hover:bg-slate-50 dark:hover:bg-slate-800/50"},[t("td",$e,o(H(s.expense_date)),1),t("td",Me,[t("div",Fe,o(s.description),1),t("div",Ue,o(s.category),1)]),t("td",Ie,o(s.category),1),t("td",Ne,"$"+o(s.amount.toFixed(2)),1),t("td",Ve,[s.bill_image_url?(d(),i("button",{key:0,onClick:w=>Q(s.bill_image_url),class:"btn btn-xs btn-ghost"},[m(y(me),{class:"w-4 h-4"})],8,Pe)):S("",!0)]),t("td",Ae,[t("button",{onClick:w=>J(s),class:"btn btn-sm btn-ghost"},[m(y(ue),{class:"w-5 h-5"}),e[14]||(e[14]=t("span",{class:"sr-only"},"Edit",-1))],8,je),t("button",{onClick:w=>X(s),class:"btn btn-sm btn-ghost text-red-500 hover:text-red-700"},[m(y(xe),{class:"w-5 h-5"}),e[15]||(e[15]=t("span",{class:"sr-only"},"Delete",-1))],8,qe)])]))),128))])])]),j.value>1?(d(),i("div",Be,[t("div",Te,[e[17]||(e[17]=b(" Showing ")),t("span",Oe,o(M.value+1),1),e[18]||(e[18]=b(" to ")),t("span",Le,o(Math.min(q.value,c.value.length)),1),e[19]||(e[19]=b(" of ")),t("span",Re,o(c.value.length),1),e[20]||(e[20]=b(" results "))]),t("div",Ge,[t("button",{onClick:e[3]||(e[3]=s=>g.value--),disabled:g.value===1,class:"btn btn-sm btn-outline"},[m(y(ie),{class:"h-4 w-4"}),e[21]||(e[21]=b(" Previous "))],8,He),t("button",{onClick:e[4]||(e[4]=s=>g.value++),disabled:g.value>=j.value,class:"btn btn-sm btn-outline"},[e[22]||(e[22]=b(" Next ")),m(y(de),{class:"h-4 w-4"})],8,ze)])])):S("",!0)]),m(ne,{"is-open":E.value,title:u.value?"Edit Expense":"Add New Expense",onClose:F},{default:ae(()=>[t("form",{onSubmit:oe(W,["prevent"]),class:"space-y-4"},[t("div",Je,[t("div",null,[e[23]||(e[23]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Date * ",-1)),x(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>l.expense_date=s),type:"date",required:"",class:"input"},null,512),[[h,l.expense_date]])]),t("div",null,[e[25]||(e[25]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Category * ",-1)),x(t("select",{"onUpdate:modelValue":e[6]||(e[6]=s=>l.category=s),required:"",class:"select"},[e[24]||(e[24]=t("option",{value:""},"Select category",-1)),(d(),i(D,null,C(A,s=>t("option",{key:s,value:s},o(s),9,Ke)),64))],512),[[R,l.category]])])]),t("div",null,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Amount * ",-1)),t("div",Qe,[e[26]||(e[26]=t("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[t("span",{class:"text-gray-500 sm:text-sm"},"$")],-1)),x(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>l.amount=s),type:"number",step:"0.01",min:"0",required:"",class:"input pl-8",placeholder:"0.00"},null,512),[[h,l.amount,void 0,{number:!0}]])])]),t("div",null,[e[28]||(e[28]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Description * ",-1)),x(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=s=>l.description=s),rows:"3",required:"",class:"textarea",placeholder:"Describe the expense..."},null,512),[[h,l.description]])]),t("div",null,[e[29]||(e[29]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Receipt Image ",-1)),t("input",{ref_key:"fileInput",ref:$,type:"file",accept:"image/*",onChange:K,class:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary-50 file:text-primary-700 hover:file:bg-primary-100"},null,544),e[30]||(e[30]=t("p",{class:"mt-1 text-sm text-gray-500"},"PNG, JPG, GIF up to 10MB",-1))]),t("div",We,[t("button",{type:"button",onClick:F,class:"btn btn-secondary"}," Cancel "),t("button",{type:"submit",disabled:k.value,class:"btn btn-primary"},o(k.value?"Saving...":u.value?"Update Expense":"Create Expense"),9,Xe)])],32)]),_:1},8,["is-open","title"])]))}});export{lt as default};
