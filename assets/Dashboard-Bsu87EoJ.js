import{d as z,h as _,i,j as B,k as F,l as O,m as R,n as U,s as v,c as r,a as t,p as W,e as c,t as n,F as h,q as k,x as P,o as l,y as N,z as D,A as j,B as Q,C as G}from"./index-D64xMZbU.js";import{t as w,s as H,f as b,p as u}from"./parseISO-Crjmnvoz.js";import{e as J}from"./endOfDay-DftzdkkI.js";import{r as K}from"./PlusIcon-BFJiKygd.js";function X(){return J(Date.now())}function Y(A,f){const d=+w(A),[p,x]=[+w(f.start),+w(f.end)].sort((y,g)=>y-g);return d>=p&&d<=x}function I(){return H(Date.now())}const Z={class:"space-y-6"},tt={class:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4"},et={class:"flex items-center space-x-2 p-2.5 bg-slate-100 dark:bg-slate-800/50 rounded-lg"},st={class:"text-sm font-medium text-slate-700 dark:text-slate-300"},at={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"},ot={class:"text-sm text-slate-500 dark:text-slate-400"},lt={class:"text-2xl font-bold text-slate-900 dark:text-slate-100"},nt={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},rt={class:"p-3 bg-primary-100 dark:bg-primary-500/10 rounded-full mb-2"},it={class:"font-medium text-slate-800 dark:text-slate-200"},ct={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},dt={class:"lg:col-span-2 card p-6"},mt={class:"overflow-x-auto"},ut={class:"w-full min-w-[600px]"},pt={class:"table-cell"},xt={class:"table-cell"},_t={class:"font-medium text-slate-800 dark:text-slate-200"},vt={class:"text-sm text-slate-500 dark:text-slate-400"},bt={class:"card p-6"},ft={class:"space-y-4"},yt={key:0,class:"text-center py-4 text-slate-500 dark:text-slate-400"},gt={key:1},ht={key:0},kt={class:"w-12 h-12 rounded-full bg-slate-100 dark:bg-slate-700 flex-shrink-0 flex flex-col items-center justify-center"},Dt={class:"text-sm font-bold text-slate-800 dark:text-slate-200"},wt={class:"text-xs text-slate-500 dark:text-slate-400"},At={class:"font-medium text-slate-800 dark:text-slate-200"},Ct={class:"text-sm text-slate-500 dark:text-slate-400"},Tt={key:1,class:"text-center py-4 text-slate-500 dark:text-slate-400"},Ft=z({__name:"Dashboard",setup(A){const f=_(()=>b(new Date,"EEEE, MMMM d, yyyy")),d=i(!0),p=i([]),x=i([]),y=i([]),g=i([]),C=i([]),T=_(()=>{const o=p.value.filter(e=>$(u(e.start_time))),a=x.value.filter(e=>$(u(e.collection_date))).reduce((e,m)=>e+(m.total_amount_manually_entered||0),0);return{appointments:o.length,revenue:a.toFixed(2)}}),L=_(()=>[{title:"Today's Appointments",value:T.value.appointments,icon:B,color:"bg-sky-500"},{title:"Today's Revenue",value:`$${T.value.revenue}`,icon:F,color:"bg-green-500"},{title:"Total Clients",value:y.value.length,icon:O,color:"bg-amber-500"},{title:"Active Barbers",value:g.value.length,icon:R,color:"bg-purple-500"}]),S=i([{name:"New Appointment",to:"/appointments",icon:K},{name:"Add Client",to:"/clients",icon:O},{name:"Log Expense",to:"/expenses",icon:F},{name:"View Services",to:"/services",icon:G}]),M=_(()=>{const o=I();return p.value.filter(s=>new Date(s.start_time)>=o&&s.status!=="cancelled"&&s.status!=="completed").sort((s,a)=>new Date(s.start_time).getTime()-new Date(a.start_time).getTime()).slice(0,5)}),V=_(()=>{const o=x.value.map(a=>{var e;return{id:`col-${a.id}`,date:a.collection_date,description:"Daily Collection",subDescription:`From ${((e=a.barber)==null?void 0:e.name)||"Unknown"}`,amount:a.total_amount_manually_entered||0,type:"income"}}),s=C.value.map(a=>({id:`exp-${a.id}`,date:a.expense_date,description:a.description,subDescription:a.category,amount:a.amount,type:"expense"}));return[...o,...s].sort((a,e)=>new Date(e.date).getTime()-new Date(a.date).getTime()).slice(0,5)});function $(o){return Y(o,{start:I(),end:X()})}function q(o){return o?b(u(o),"MMM d, yyyy"):"N/A"}return U(async()=>{d.value=!0;try{const[{data:o},{data:s},{data:a},{data:e},{data:m}]=await Promise.all([v.from("appointments").select("*, client:clients(*), barber:barbers(*)"),v.from("daily_collections").select("*, barber:barbers(*)"),v.from("clients").select("*",{count:"exact"}),v.from("barbers").select("*",{count:"exact"}),v.from("expenses").select("*")]);p.value=o||[],x.value=s||[],y.value=a||[],g.value=e||[],C.value=m||[]}catch(o){console.error("Error fetching dashboard data:",o)}finally{d.value=!1}}),(o,s)=>{const a=P("router-link");return l(),r("div",Z,[t("div",tt,[s[0]||(s[0]=t("div",null,[t("h1",{class:"text-2xl font-bold text-slate-900 dark:text-slate-100"},"Dashboard"),t("p",{class:"text-slate-500 dark:text-slate-400"},"Welcome back, Admin!")],-1)),t("div",et,[W(c(B),{class:"w-5 h-5 text-slate-500 dark:text-slate-400"}),t("span",st,n(f.value),1)])]),t("div",at,[(l(!0),r(h,null,k(L.value,e=>(l(),r("div",{key:e.title,class:"card p-6 flex items-center space-x-4"},[t("div",{class:N(["p-3 rounded-full",e.color])},[(l(),D(j(e.icon),{class:"w-6 h-6 text-white"}))],2),t("div",null,[t("p",ot,n(e.title),1),t("p",lt,n(e.value),1)])]))),128))]),t("div",null,[s[1]||(s[1]=t("h2",{class:"text-lg font-semibold text-slate-900 dark:text-slate-100 mb-4"},"Quick Actions",-1)),t("div",nt,[(l(!0),r(h,null,k(S.value,e=>(l(),D(a,{key:e.name,to:e.to,class:"card p-4 flex flex-col items-center justify-center text-center hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors"},{default:Q(()=>[t("div",rt,[(l(),D(j(e.icon),{class:"w-6 h-6 text-primary-600 dark:text-primary-300"}))]),t("p",it,n(e.name),1)]),_:2},1032,["to"]))),128))])]),t("div",ct,[t("div",dt,[s[3]||(s[3]=t("h2",{class:"text-lg font-semibold text-slate-900 dark:text-slate-100 mb-4"},"Recent Activity",-1)),t("div",mt,[t("table",ut,[s[2]||(s[2]=t("thead",null,[t("tr",null,[t("th",{class:"table-header pb-2"},"Date"),t("th",{class:"table-header pb-2"},"Description"),t("th",{class:"table-header pb-2 text-right"},"Amount")])],-1)),t("tbody",null,[(l(!0),r(h,null,k(V.value,e=>(l(),r("tr",{key:e.id,class:"table-row"},[t("td",pt,n(q(e.date)),1),t("td",xt,[t("div",_t,n(e.description),1),t("div",vt,n(e.subDescription),1)]),t("td",{class:N(["table-cell text-right",e.type==="income"?"text-green-600":"text-red-600"])},n(e.type==="income"?"+":"-")+"$"+n(e.amount.toFixed(2)),3)]))),128))])])])]),t("div",bt,[s[4]||(s[4]=t("h2",{class:"text-lg font-semibold text-slate-900 dark:text-slate-100 mb-4"},"Upcoming Appointments",-1)),t("div",ft,[d.value?(l(),r("div",yt,"Loading...")):(l(),r("div",gt,[M.value.length>0?(l(),r("div",ht,[(l(!0),r(h,null,k(M.value,e=>{var m,E;return l(),r("div",{key:e.id,class:"flex items-center space-x-4"},[t("div",kt,[t("span",Dt,n(c(b)(c(u)(e.start_time),"d")),1),t("span",wt,n(c(b)(c(u)(e.start_time),"MMM")),1)]),t("div",null,[t("p",At,n((m=e.client)==null?void 0:m.name),1),t("p",Ct,n(c(b)(c(u)(e.start_time),"h:mm a"))+" with "+n((E=e.barber)==null?void 0:E.name),1)])])}),128))])):(l(),r("div",Tt," No upcoming appointments. "))]))])])])])}}});export{Ft as default};
