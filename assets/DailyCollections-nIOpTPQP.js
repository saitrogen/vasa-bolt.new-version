import{d as z,i as c,r as B,h as H,n as L,c as r,a as e,p as w,e as V,M as G,b as i,v as p,E as I,F as D,q as h,B as J,s as b,H as K,t as d,y as P,w as Q,o as u}from"./index-DAGt-Z2F.js";import{_ as R}from"./Modal.vue_vue_type_script_setup_true_lang-Bwcosh1h.js";import{r as X}from"./PlusIcon-DmRcEgN9.js";import{f as Y,p as Z}from"./parseISO-Crjmnvoz.js";const tt={class:"space-y-6"},et={class:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4"},at={class:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-500/30 rounded-lg p-4"},lt={class:"flex"},st={class:"card p-4"},ot={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},nt=["value"],rt={class:"card overflow-hidden"},it={class:"overflow-x-auto"},dt={class:"min-w-full inline-block align-middle"},ut={class:"overflow-hidden"},ct={class:"min-w-full divide-y divide-slate-200 dark:divide-slate-800"},mt={class:"divide-y divide-slate-200 dark:divide-slate-800"},pt={class:"table-cell px-6 py-4"},bt={class:"table-cell px-6 py-4 font-medium"},ft={class:"table-cell px-6 py-4 text-right"},_t={class:"table-cell px-6 py-4 text-right"},yt={class:"table-cell px-6 py-4 text-right"},vt=["onClick"],xt=["value"],Ct=z({__name:"DailyCollections",setup(gt){const{addToast:_}=K(),y=c([]),v=c([]),k=c([]),C=c(!0),x=c(!1),M=c(null),o=B({startDate:"",endDate:"",barberId:""}),s=B({id:null,collection_date:new Date().toISOString().substring(0,10),barber_id:"",total_amount_manually_entered:0,notes:""}),E=H(()=>y.value.filter(l=>{const t=new Date(l.collection_date),a=o.startDate?new Date(o.startDate):null,n=o.endDate?new Date(o.endDate):null;return!(a&&t<a||n&&t>n||o.barberId&&l.barber_id!==o.barberId)})),U=l=>Y(Z(l),"MMM d, yyyy"),$=(l,t)=>l===void 0?"N/A":(t-l).toFixed(2),T=(l,t)=>{if(l===void 0)return"";const a=t-l;return a>0?"text-green-500":a<0?"text-red-500":""},A=l=>{M.value=l,l?(s.id=l.id,s.collection_date=l.collection_date,s.barber_id=l.barber_id,s.total_amount_manually_entered=l.total_amount_manually_entered,s.notes=l.notes||""):(s.id=null,s.collection_date=new Date().toISOString().substring(0,10),s.barber_id="",s.total_amount_manually_entered=0,s.notes=""),x.value=!0},g=()=>{x.value=!1},q=async()=>{const l={collection_date:s.collection_date,barber_id:s.barber_id,total_amount_manually_entered:s.total_amount_manually_entered,notes:s.notes};let t;s.id?{error:t}=await b.from("daily_collections").update(l).eq("id",s.id):{error:t}=await b.from("daily_collections").insert(l),t?_({type:"error",title:"Error",message:t.message}):(_({type:"success",title:"Success",message:"Collection saved!"}),g(),S())},S=async()=>{C.value=!0;const{data:l,error:t}=await b.from("daily_collections").select("*, barber:barbers(*)").order("collection_date",{ascending:!1});if(t)_({type:"error",title:"Error",message:t.message}),y.value=[];else{const a=(l||[]).map(n=>{const f=n.collection_date,j=k.value.filter(m=>m.barber_id===n.barber_id&&m.start_time.startsWith(f)&&m.status==="completed").reduce((m,W)=>m+(W.total_amount||0),0);return{...n,total_amount_calculated:j}});y.value=a}C.value=!1},F=async()=>{const{data:l,error:t}=await b.from("barbers").select("*");t||(v.value=l)},N=async()=>{const{data:l,error:t}=await b.from("appointments").select("*");t||(k.value=l)};return L(async()=>{await F(),await N(),await S()}),(l,t)=>(u(),r("div",tt,[e("div",et,[t[9]||(t[9]=e("h1",{class:"text-2xl font-bold text-slate-900 dark:text-slate-100"},"Daily Collections",-1)),e("button",{onClick:t[0]||(t[0]=a=>A(null)),class:"btn btn-primary"},[w(V(X),{class:"w-4 h-4 md:mr-2"}),t[8]||(t[8]=e("span",{class:"hidden md:inline"},"Add Collection",-1))])]),e("div",at,[e("div",lt,[w(V(G),{class:"h-5 w-5 text-blue-400 dark:text-blue-300 mt-0.5"}),t[10]||(t[10]=e("div",{class:"ml-3"},[e("h3",{class:"text-sm font-medium text-blue-800 dark:text-blue-200"},"Manual Collection Entry"),e("div",{class:"mt-2 text-sm text-blue-700 dark:text-blue-300"},[e("p",null,"This section allows you to manually record daily collection totals as a safety net or transitional tool. The primary revenue tracking is automatically calculated from completed appointments.")])],-1))])]),e("div",st,[e("div",ot,[i(e("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>o.startDate=a),type:"date",class:"input"},null,512),[[p,o.startDate]]),i(e("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>o.endDate=a),type:"date",class:"input"},null,512),[[p,o.endDate]]),i(e("select",{"onUpdate:modelValue":t[3]||(t[3]=a=>o.barberId=a),class:"select"},[t[11]||(t[11]=e("option",{value:""},"All Barbers",-1)),(u(!0),r(D,null,h(v.value,a=>(u(),r("option",{key:a.id,value:a.id},d(a.name),9,nt))),128))],512),[[I,o.barberId]])])]),e("div",rt,[e("div",it,[e("div",dt,[e("div",ut,[e("table",ct,[t[12]||(t[12]=e("thead",null,[e("tr",null,[e("th",{scope:"col",class:"table-header px-6 py-3 text-left"},"Date"),e("th",{scope:"col",class:"table-header px-6 py-3 text-left"},"Barber"),e("th",{scope:"col",class:"table-header px-6 py-3 text-right"},"Calculated Amount"),e("th",{scope:"col",class:"table-header px-6 py-3 text-right"},"Manual Amount"),e("th",{scope:"col",class:"table-header px-6 py-3 text-right"},"Difference"),e("th",{scope:"col",class:"table-header px-6 py-3 text-right"},"Actions")])],-1)),e("tbody",mt,[(u(!0),r(D,null,h(E.value,a=>{var n,f;return u(),r("tr",{key:a.id,class:"table-row"},[e("td",pt,d(U(a.collection_date)),1),e("td",bt,d(((n=a.barber)==null?void 0:n.name)||"N/A"),1),e("td",ft,"$"+d(((f=a.total_amount_calculated)==null?void 0:f.toFixed(2))??"0.00"),1),e("td",_t,"$"+d(a.total_amount_manually_entered.toFixed(2)),1),e("td",{class:P(["table-cell px-6 py-4 text-right",T(a.total_amount_calculated,a.total_amount_manually_entered)])}," $"+d($(a.total_amount_calculated,a.total_amount_manually_entered)),3),e("td",yt,[e("button",{onClick:O=>A(a),class:"btn btn-ghost"},"Edit",8,vt)])])}),128))])])])])])]),w(R,{"is-open":x.value,title:M.value?"Edit Collection":"Add Collection",onClose:g},{default:J(()=>[e("form",{onSubmit:Q(q,["prevent"]),class:"space-y-4"},[e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium"},"Date",-1)),i(e("input",{"onUpdate:modelValue":t[4]||(t[4]=a=>s.collection_date=a),type:"date",required:"",class:"input"},null,512),[[p,s.collection_date]])]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium"},"Barber",-1)),i(e("select",{"onUpdate:modelValue":t[5]||(t[5]=a=>s.barber_id=a),required:"",class:"select"},[t[14]||(t[14]=e("option",{value:""},"Select Barber",-1)),(u(!0),r(D,null,h(v.value,a=>(u(),r("option",{key:a.id,value:a.id},d(a.name),9,xt))),128))],512),[[I,s.barber_id]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium"},"Manual Amount",-1)),i(e("input",{"onUpdate:modelValue":t[6]||(t[6]=a=>s.total_amount_manually_entered=a),type:"number",step:"0.01",required:"",class:"input"},null,512),[[p,s.total_amount_manually_entered,void 0,{number:!0}]])]),e("div",null,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium"},"Notes",-1)),i(e("textarea",{"onUpdate:modelValue":t[7]||(t[7]=a=>s.notes=a),class:"textarea"},null,512),[[p,s.notes]])]),e("div",{class:"flex justify-end gap-2"},[e("button",{type:"button",onClick:g,class:"btn btn-outline"},"Cancel"),t[18]||(t[18]=e("button",{type:"submit",class:"btn btn-primary"},"Save",-1))])],32)]),_:1},8,["is-open","title"])]))}});export{Ct as default};
