import{d as z,h as v,i as c,j as B,k as F,l as O,m as R,n as U,s as b,c as r,a as t,p as W,e as d,t as l,F as k,q as D,x as H,o as n,y as N,z as A,A as j,B as P,C as Q}from"./index-CNX9MZ4u.js";import{t as w,s as G,f,p}from"./parseISO-Crjmnvoz.js";import{r as J}from"./PlusIcon-Bj8oeeNx.js";function K(y){const i=w(y);return i.setHours(23,59,59,999),i}function X(){return K(Date.now())}function Y(y,i){const u=+w(y),[x,_]=[+w(i.start),+w(i.end)].sort((g,h)=>g-h);return u>=x&&u<=_}function I(){return G(Date.now())}const Z={class:"space-y-6"},tt={class:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4"},et={class:"flex items-center space-x-2 p-2.5 bg-slate-100 dark:bg-slate-800/50 rounded-lg"},st={class:"text-sm font-medium text-slate-700 dark:text-slate-300"},at={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"},ot={class:"text-sm text-slate-500 dark:text-slate-400"},nt={class:"text-2xl font-bold text-slate-900 dark:text-slate-100"},lt={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},rt={class:"p-3 bg-primary-100 dark:bg-primary-500/10 rounded-full mb-2"},it={class:"font-medium text-slate-800 dark:text-slate-200"},ct={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},dt={class:"lg:col-span-2 card p-6"},ut={class:"overflow-x-auto"},mt={class:"w-full min-w-[600px]"},pt={class:"table-cell"},xt={class:"table-cell"},_t={class:"font-medium text-slate-800 dark:text-slate-200"},vt={class:"text-sm text-slate-500 dark:text-slate-400"},bt={class:"card p-6"},ft={class:"space-y-4"},yt={key:0,class:"text-center py-4 text-slate-500 dark:text-slate-400"},gt={key:1},ht={key:0},kt={class:"w-12 h-12 rounded-full bg-slate-100 dark:bg-slate-700 flex-shrink-0 flex flex-col items-center justify-center"},Dt={class:"text-sm font-bold text-slate-800 dark:text-slate-200"},wt={class:"text-xs text-slate-500 dark:text-slate-400"},At={class:"font-medium text-slate-800 dark:text-slate-200"},Ct={class:"text-sm text-slate-500 dark:text-slate-400"},Tt={key:1,class:"text-center py-4 text-slate-500 dark:text-slate-400"},Bt=z({__name:"Dashboard",setup(y){const i=v(()=>f(new Date,"EEEE, MMMM d, yyyy")),u=c(!0),x=c([]),_=c([]),g=c([]),h=c([]),C=c([]),T=v(()=>{const o=x.value.filter(e=>$(p(e.start_time))),a=_.value.filter(e=>$(p(e.collection_date))).reduce((e,m)=>e+(m.total_amount_manually_entered||0),0);return{appointments:o.length,revenue:a.toFixed(2)}}),L=v(()=>[{title:"Today's Appointments",value:T.value.appointments,icon:B,color:"bg-sky-500"},{title:"Today's Revenue",value:`$${T.value.revenue}`,icon:F,color:"bg-green-500"},{title:"Total Clients",value:g.value.length,icon:O,color:"bg-amber-500"},{title:"Active Barbers",value:h.value.length,icon:R,color:"bg-purple-500"}]),S=c([{name:"New Appointment",to:"/appointments",icon:J},{name:"Add Client",to:"/clients",icon:O},{name:"Log Expense",to:"/expenses",icon:F},{name:"View Services",to:"/services",icon:Q}]),M=v(()=>{const o=I();return x.value.filter(s=>new Date(s.start_time)>=o&&s.status!=="cancelled"&&s.status!=="completed").sort((s,a)=>new Date(s.start_time).getTime()-new Date(a.start_time).getTime()).slice(0,5)}),V=v(()=>{const o=_.value.map(a=>{var e;return{id:`col-${a.id}`,date:a.collection_date,description:"Daily Collection",subDescription:`From ${((e=a.barber)==null?void 0:e.name)||"Unknown"}`,amount:a.total_amount_manually_entered||0,type:"income"}}),s=C.value.map(a=>({id:`exp-${a.id}`,date:a.expense_date,description:a.description,subDescription:a.category,amount:a.amount,type:"expense"}));return[...o,...s].sort((a,e)=>new Date(e.date).getTime()-new Date(a.date).getTime()).slice(0,5)});function $(o){return Y(o,{start:I(),end:X()})}function q(o){return o?f(p(o),"MMM d, yyyy"):"N/A"}return U(async()=>{u.value=!0;try{const[{data:o},{data:s},{data:a},{data:e},{data:m}]=await Promise.all([b.from("appointments").select("*, client:clients(*), barber:barbers(*)"),b.from("daily_collections").select("*, barber:barbers(*)"),b.from("clients").select("*",{count:"exact"}),b.from("barbers").select("*",{count:"exact"}),b.from("expenses").select("*")]);x.value=o||[],_.value=s||[],g.value=a||[],h.value=e||[],C.value=m||[]}catch(o){console.error("Error fetching dashboard data:",o)}finally{u.value=!1}}),(o,s)=>{const a=H("router-link");return n(),r("div",Z,[t("div",tt,[s[0]||(s[0]=t("div",null,[t("h1",{class:"text-2xl font-bold text-slate-900 dark:text-slate-100"},"Dashboard"),t("p",{class:"text-slate-500 dark:text-slate-400"},"Welcome back, Admin!")],-1)),t("div",et,[W(d(B),{class:"w-5 h-5 text-slate-500 dark:text-slate-400"}),t("span",st,l(i.value),1)])]),t("div",at,[(n(!0),r(k,null,D(L.value,e=>(n(),r("div",{key:e.title,class:"card p-6 flex items-center space-x-4"},[t("div",{class:N(["p-3 rounded-full",e.color])},[(n(),A(j(e.icon),{class:"w-6 h-6 text-white"}))],2),t("div",null,[t("p",ot,l(e.title),1),t("p",nt,l(e.value),1)])]))),128))]),t("div",null,[s[1]||(s[1]=t("h2",{class:"text-lg font-semibold text-slate-900 dark:text-slate-100 mb-4"},"Quick Actions",-1)),t("div",lt,[(n(!0),r(k,null,D(S.value,e=>(n(),A(a,{key:e.name,to:e.to,class:"card p-4 flex flex-col items-center justify-center text-center hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors"},{default:P(()=>[t("div",rt,[(n(),A(j(e.icon),{class:"w-6 h-6 text-primary-600 dark:text-primary-300"}))]),t("p",it,l(e.name),1)]),_:2},1032,["to"]))),128))])]),t("div",ct,[t("div",dt,[s[3]||(s[3]=t("h2",{class:"text-lg font-semibold text-slate-900 dark:text-slate-100 mb-4"},"Recent Activity",-1)),t("div",ut,[t("table",mt,[s[2]||(s[2]=t("thead",null,[t("tr",null,[t("th",{class:"table-header pb-2"},"Date"),t("th",{class:"table-header pb-2"},"Description"),t("th",{class:"table-header pb-2 text-right"},"Amount")])],-1)),t("tbody",null,[(n(!0),r(k,null,D(V.value,e=>(n(),r("tr",{key:e.id,class:"table-row"},[t("td",pt,l(q(e.date)),1),t("td",xt,[t("div",_t,l(e.description),1),t("div",vt,l(e.subDescription),1)]),t("td",{class:N(["table-cell text-right",e.type==="income"?"text-green-600":"text-red-600"])},l(e.type==="income"?"+":"-")+"$"+l(e.amount.toFixed(2)),3)]))),128))])])])]),t("div",bt,[s[4]||(s[4]=t("h2",{class:"text-lg font-semibold text-slate-900 dark:text-slate-100 mb-4"},"Upcoming Appointments",-1)),t("div",ft,[u.value?(n(),r("div",yt,"Loading...")):(n(),r("div",gt,[M.value.length>0?(n(),r("div",ht,[(n(!0),r(k,null,D(M.value,e=>{var m,E;return n(),r("div",{key:e.id,class:"flex items-center space-x-4"},[t("div",kt,[t("span",Dt,l(d(f)(d(p)(e.start_time),"d")),1),t("span",wt,l(d(f)(d(p)(e.start_time),"MMM")),1)]),t("div",null,[t("p",At,l((m=e.client)==null?void 0:m.name),1),t("p",Ct,l(d(f)(d(p)(e.start_time),"h:mm a"))+" with "+l((E=e.barber)==null?void 0:E.name),1)])])}),128))])):(n(),r("div",Tt," No upcoming appointments. "))]))])])])])}}});export{Bt as default};
