import{c as n,a as e,o,d as _e,D as we,h,i as u,r as ke,n as De,p as c,e as v,b as f,g as C,t as r,I as Ce,v as E,F as $,q as M,E as se,f as g,B as le,s as _,H as Ee,w as $e}from"./index-BFEQWBay.js";import{E as Me,a as Fe}from"./jspdf.plugin.autotable-BceNMa6r.js";import{_ as ae}from"./Modal.vue_vue_type_script_setup_true_lang-DrVpGJl3.js";import{r as Se}from"./PlusIcon-NzFvHLfC.js";import{r as Pe,a as Ne}from"./ChevronRightIcon-350qRXwI.js";import{r as ne}from"./PencilSquareIcon-DVxBfWgh.js";import{r as oe}from"./TrashIcon-D-UsiS2K.js";import{a as Te,s as re,e as ie}from"./subMonths-DgZhT8O2.js";import{f as V,p as Ue}from"./parseISO-Crjmnvoz.js";function R(Z,p){return o(),n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})])}function je(Z,p){return o(),n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 0 1-.659 1.591l-5.432 5.432a2.25 2.25 0 0 0-.659 1.591v2.927a2.25 2.25 0 0 1-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 0 0-.659-1.591L3.659 7.409A2.25 2.25 0 0 1 3 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0 1 12 3Z"})])}const Ae={class:"space-y-6"},Ve={class:"sticky top-0 z-10 py-4 bg-slate-50/50 dark:bg-slate-900/50 backdrop-blur-sm sm:-mx-4 sm:px-4"},Be={class:"flex flex-row sm:flex-row justify-between items-start sm:items-center gap-4"},Oe={class:"card p-4"},qe={class:"sm:hidden mb-4"},Ie={class:"transition-all"},ze={class:"grid grid-cols-2 sm:grid-cols-3 gap-4"},Le=["value"],Re={class:"mt-4 flex flex-wrap items-center gap-2"},Ze={class:"mt-4 border-t border-slate-200 dark:border-slate-700 pt-4 flex items-center justify-between"},He={class:"text-sm text-gray-600 dark:text-gray-300"},Qe={class:"flex items-center gap-2"},Ye={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},Ge={class:"card overflow-hidden"},Je={class:"hidden sm:block overflow-x-auto overflow-y-auto max-h-[60vh]"},Ke={class:"min-w-full divide-y divide-slate-200 dark:divide-slate-700"},We={class:"divide-y divide-slate-200 dark:divide-slate-700 bg-white dark:bg-slate-900"},Xe={key:1},et={class:"px-6 py-4 whitespace-nowrap text-sm text-slate-500 dark:text-slate-400"},tt={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900 dark:text-slate-100"},st={class:"px-6 py-4 whitespace-nowrap text-sm text-slate-500 dark:text-slate-400"},lt={class:"px-6 py-4 whitespace-nowrap text-sm text-slate-500 dark:text-slate-400"},at={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium text-slate-800 dark:text-slate-200"},nt={class:"px-6 py-4 whitespace-nowrap text-center"},ot=["href"],rt={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},it=["onClick"],dt=["onClick"],ut={class:"block sm:hidden"},ct={key:0,class:"p-4"},pt={key:1,class:"p-10 text-center text-slate-500"},vt={key:2,class:"divide-y divide-slate-200 dark:divide-slate-700"},mt={class:"flex justify-between items-start"},xt={class:"font-semibold text-slate-900 dark:text-slate-100"},bt={class:"text-sm text-slate-500 dark:text-slate-400"},ft={class:"text-sm text-slate-500 dark:text-slate-400"},gt={class:"font-semibold text-lg text-slate-800 dark:text-slate-200"},yt={key:0,class:"mt-2 text-sm text-slate-600 dark:text-slate-300"},ht={class:"mt-3 flex justify-end items-center gap-2"},_t=["href"],wt=["onClick"],kt=["onClick"],Dt={key:0,class:"card-footer flex items-center justify-between"},Ct={class:"text-sm text-slate-600 dark:text-slate-400"},Et={class:"font-medium"},$t={class:"font-medium"},Mt={class:"font-medium"},Ft={class:"flex items-center gap-1"},St=["disabled"],Pt=["disabled"],Nt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Tt={class:"relative"},Ut={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},jt=["value"],At={key:0,class:"text-xs text-slate-500 mt-1"},Vt={class:"flex justify-end gap-3 pt-4"},Bt=["disabled"],Ot={class:"w-full h-[75vh]"},qt=["src"],It={class:"flex justify-end gap-2 mt-4"},zt=["href","download"],Wt=_e({__name:"Expenses",setup(Z){const{addToast:p}=Ee(),{width:de}=we(),ue=h(()=>de.value<640),w=u(!1),k=u(!1),H=u([]),B=u([]),N=u(!1),m=u(null),O=u(!1),F=u(""),T=u(!1),i=ke({startDate:"",endDate:"",category_id:""}),q=l=>{const t=new Date;let s,a;switch(l){case"today":s=t,a=t;break;case"this_month":s=re(t),a=ie(t);break;case"last_month":const y=Te(t);s=re(y),a=ie(y);break}i.startDate=V(s,"yyyy-MM-dd"),i.endDate=V(a,"yyyy-MM-dd")},ce=()=>{i.startDate="",i.endDate=""},Q=()=>({name:"",amount:0,notes:"",expense_date:new Date().toISOString().substring(0,10),category_id:"",bill_url:null}),d=u(Q()),D=u(null),S=u(1),I=u(10),x=h(()=>{let l=H.value;return i.startDate&&(l=l.filter(t=>t.expense_date>=i.startDate)),i.endDate&&(l=l.filter(t=>t.expense_date<=i.endDate)),i.category_id&&(l=l.filter(t=>t.category_id===Number(i.category_id))),l}),Y=h(()=>x.value.reduce((l,t)=>l+t.amount,0)),G=h(()=>Math.ceil(x.value.length/I.value)),z=h(()=>(S.value-1)*I.value),J=h(()=>z.value+I.value),U=h(()=>x.value.slice(z.value,J.value)),j=async()=>{w.value=!0;const{data:l,error:t}=await _.from("expenses").select("*, expense_categories(id, name)").order("expense_date",{ascending:!1});t?(p({title:"Error",message:"Failed to fetch expenses.",type:"error"}),console.error(t)):H.value=l,w.value=!1},pe=async()=>{const{data:l,error:t}=await _.from("expense_categories").select("*").eq("is_active",!0).order("name");t?(p({title:"Error",message:"Failed to fetch expense categories.",type:"error"}),console.error(t)):B.value=l},ve=l=>{const t=l.target;t.files&&t.files.length>0?D.value=t.files[0]:D.value=null},me=async l=>{const t=l.name.split(".").pop(),a=`public/expense-bills/${`${Date.now()}.${t}`}`,{error:y}=await _.storage.from("expense-bills").upload(a,l);if(y)return console.error("Error uploading file:",y),p({title:"Error",message:"Failed to upload bill.",type:"error"}),null;const{data:L}=_.storage.from("expense-bills").getPublicUrl(a);return L.publicUrl},xe=async()=>{var s;if(k.value)return;k.value=!0;let l=((s=m.value)==null?void 0:s.bill_url)||null;if(D.value){const a=await me(D.value);if(a)l=a;else{k.value=!1;return}}const t={...d.value,bill_url:l};if(m.value){const{error:a}=await _.from("expenses").update(t).eq("id",m.value.id);a?p({title:"Error",message:`Error updating expense: ${a.message}`,type:"error"}):(p({title:"Success",message:"Expense updated successfully.",type:"success"}),A(),j())}else{const{error:a}=await _.from("expenses").insert(t);a?p({title:"Error",message:`Error creating expense: ${a.message}`,type:"error"}):(p({title:"Success",message:"Expense created successfully.",type:"success"}),A(),j())}k.value=!1},be=()=>{m.value=null,d.value=Q(),D.value=null,N.value=!0},K=l=>{m.value=l,d.value={...l,category_id:l.category_id},D.value=null,N.value=!0},W=async l=>{if(confirm(`Are you sure you want to delete the expense "${l.name}"?`)){const{error:t}=await _.from("expenses").delete().eq("id",l.id);t?p({title:"Error",message:`Error deleting expense: ${t.message}`,type:"error"}):(p({title:"Success",message:"Expense deleted successfully.",type:"success"}),j())}},A=()=>{N.value=!1,m.value=null},X=()=>{O.value=!1,F.value=""},P=l=>{if(!l)return"";try{return V(Ue(l),"MMM d, yyyy")}catch{return V(new Date(l),"MMM d, yyyy")}},fe=()=>{var ee,te;const l=new Me,t="Expense Report";let s=i.startDate,a=i.endDate;if(!s||!a){const b=[...x.value].sort((ye,he)=>new Date(ye.expense_date).getTime()-new Date(he.expense_date).getTime());s=((ee=b[0])==null?void 0:ee.expense_date)||new Date().toISOString().split("T")[0],a=((te=b[b.length-1])==null?void 0:te.expense_date)||new Date().toISOString().split("T")[0]}const y=`From ${P(s)} to ${P(a)}`;l.setFontSize(18),l.text(t,14,22),l.setFontSize(11),l.text(y,14,30);const L=[["Date","Name","Category","Notes","Amount"]],ge=x.value.map(b=>[P(b.expense_date),b.name,b.expense_categories.name,b.notes||"-",`$${b.amount.toFixed(2)}`]);Fe(l,{startY:35,head:L,body:ge,theme:"grid",styles:{fontSize:8},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},columnStyles:{3:{halign:"right"},4:{halign:"right"}},foot:[["","","","Total",`$${Y.value.toFixed(2)}`]],footStyles:{fontStyle:"bold",fillColor:[84,95,107],textColor:255}}),F.value=l.output("datauristring"),O.value=!0};return De(()=>{j(),pe()}),(l,t)=>(o(),n("div",Ae,[e("div",Ve,[e("div",Be,[t[15]||(t[15]=e("h1",{class:"text-2xl font-bold text-slate-900 dark:text-slate-100"},"Expenses",-1)),e("button",{onClick:be,class:"btn btn-primary"},[c(v(Se),{class:"w-4 h-4 md:mr-2"}),t[14]||(t[14]=e("span",{class:"md:inline"},"Add Expense",-1))])])]),e("div",Oe,[e("div",qe,[e("button",{onClick:t[0]||(t[0]=s=>T.value=!T.value),class:"btn btn-outline w-full justify-center"},[c(v(je),{class:"w-4 h-4 mr-2"}),C(" "+r(T.value?"Hide Filters":"Show Filters"),1)])]),f(e("div",Ie,[e("div",ze,[f(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>i.startDate=s),type:"date",class:"input"},null,512),[[E,i.startDate]]),f(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>i.endDate=s),type:"date",class:"input"},null,512),[[E,i.endDate]]),f(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>i.category_id=s),class:"select"},[t[16]||(t[16]=e("option",{value:""},"All Categories",-1)),(o(!0),n($,null,M(B.value,s=>(o(),n("option",{key:s.id,value:s.id},r(s.name),9,Le))),128))],512),[[se,i.category_id]])]),e("div",Re,[t[17]||(t[17]=e("span",{class:"text-sm font-medium text-slate-600 dark:text-slate-400"},"Quick Filters:",-1)),e("button",{onClick:t[4]||(t[4]=s=>q("today")),class:"btn btn-xs btn-outline"},"Today"),e("button",{onClick:t[5]||(t[5]=s=>q("this_month")),class:"btn btn-xs btn-outline"},"This Month"),e("button",{onClick:t[6]||(t[6]=s=>q("last_month")),class:"btn btn-xs btn-outline"},"Last Month"),e("button",{onClick:ce,class:"btn btn-xs btn-ghost text-red-500 btn-outline"},"Clear Filter")])],512),[[Ce,T.value||!ue.value]]),e("div",Ze,[e("div",He,r(x.value.length)+" expense"+r(x.value.length!==1?"s":""),1),e("div",Qe,[e("button",{onClick:fe,class:"btn btn-sm btn-outline"},[c(v(R),{class:"w-4 h-4 mr-2"}),t[18]||(t[18]=e("span",null,"Preview PDF",-1))]),e("div",Ye," Total: $"+r(Y.value.toFixed(2)),1)])])]),e("div",Ge,[e("div",Je,[e("table",Ke,[t[23]||(t[23]=e("thead",{class:"bg-slate-50 dark:bg-slate-800 sticky top-0 z-10"},[e("tr",null,[e("th",{scope:"col",class:"table-header px-6 py-3 text-left"},"Date"),e("th",{scope:"col",class:"table-header px-6 py-3 text-left"},"Name"),e("th",{scope:"col",class:"table-header px-6 py-3 text-left"},"Category"),e("th",{scope:"col",class:"table-header px-6 py-3 text-left"},"Notes"),e("th",{scope:"col",class:"table-header px-6 py-3 text-right"},"Amount"),e("th",{scope:"col",class:"table-header px-6 py-3 text-center"},"Bill"),e("th",{scope:"col",class:"table-header px-6 py-3 text-right"},"Actions")])],-1)),e("tbody",We,[w.value?(o(),n($,{key:0},M(5,s=>e("tr",{key:s},t[19]||(t[19]=[e("td",{class:"px-6 py-4 whitespace-nowrap",colspan:"7"},[e("div",{class:"animate-pulse flex space-x-4"},[e("div",{class:"flex-1 space-y-2 py-1"},[e("div",{class:"h-2 bg-slate-200 dark:bg-slate-700 rounded"}),e("div",{class:"h-2 bg-slate-200 dark:bg-slate-700 rounded w-5/6"})])])],-1)]))),64)):g("",!0),!w.value&&U.value.length===0?(o(),n("tr",Xe,t[20]||(t[20]=[e("td",{class:"text-center py-10",colspan:"7"},[e("div",{class:"text-center text-slate-500"},[e("p",{class:"font-medium"},"No expenses found"),e("p",{class:"text-sm"},"Try adjusting your filters.")])],-1)]))):g("",!0),(o(!0),n($,null,M(U.value,s=>(o(),n("tr",{key:s.id,class:"hover:bg-slate-50 dark:hover:bg-slate-800/50"},[e("td",et,r(P(s.expense_date)),1),e("td",tt,r(s.name),1),e("td",st,r(s.expense_categories.name),1),e("td",lt,r(s.notes),1),e("td",at," $"+r(s.amount.toFixed(2)),1),e("td",nt,[s.bill_url?(o(),n("a",{key:0,href:s.bill_url,target:"_blank",class:"btn btn-xs btn-ghost"},[c(v(R),{class:"w-4 h-4"})],8,ot)):g("",!0)]),e("td",rt,[e("button",{onClick:a=>K(s),class:"btn btn-sm btn-ghost"},[c(v(ne),{class:"w-5 h-5"}),t[21]||(t[21]=e("span",{class:"sr-only"},"Edit",-1))],8,it),e("button",{onClick:a=>W(s),class:"btn btn-sm btn-ghost text-red-500 hover:text-red-700"},[c(v(oe),{class:"w-5 h-5"}),t[22]||(t[22]=e("span",{class:"sr-only"},"Delete",-1))],8,dt)])]))),128))])])]),e("div",ut,[w.value?(o(),n("div",ct,[(o(),n($,null,M(5,s=>e("div",{key:s,class:"border-b border-slate-200 dark:border-slate-700 p-4"},t[24]||(t[24]=[e("div",{class:"animate-pulse flex space-x-4"},[e("div",{class:"flex-1 space-y-2 py-1"},[e("div",{class:"h-2 bg-slate-200 dark:bg-slate-700 rounded"}),e("div",{class:"h-2 bg-slate-200 dark:bg-slate-700 rounded w-5/6"})])],-1)]))),64))])):g("",!0),!w.value&&U.value.length===0?(o(),n("div",pt,t[25]||(t[25]=[e("p",{class:"font-medium"},"No expenses found",-1),e("p",{class:"text-sm"},"Try adjusting your filters.",-1)]))):(o(),n("ul",vt,[(o(!0),n($,null,M(U.value,s=>(o(),n("li",{key:s.id,class:"p-4"},[e("div",mt,[e("div",null,[e("p",xt,r(s.name),1),e("p",bt,r(s.expense_categories.name),1),e("p",ft,r(P(s.expense_date)),1)]),e("p",gt,"$"+r(s.amount.toFixed(2)),1)]),s.notes?(o(),n("p",yt,r(s.notes),1)):g("",!0),e("div",ht,[s.bill_url?(o(),n("a",{key:0,href:s.bill_url,target:"_blank",class:"btn btn-xs btn-ghost"},[c(v(R),{class:"w-4 h-4 mr-1"}),t[26]||(t[26]=C(" Bill "))],8,_t)):g("",!0),e("button",{onClick:a=>K(s),class:"btn btn-xs btn-ghost"},[c(v(ne),{class:"w-4 h-4"})],8,wt),e("button",{onClick:a=>W(s),class:"btn btn-xs btn-ghost text-red-500"},[c(v(oe),{class:"w-4 h-4"})],8,kt)])]))),128))]))]),G.value>1?(o(),n("div",Dt,[e("div",Ct,[t[27]||(t[27]=C(" Showing ")),e("span",Et,r(z.value+1),1),t[28]||(t[28]=C(" to ")),e("span",$t,r(Math.min(J.value,x.value.length)),1),t[29]||(t[29]=C(" of ")),e("span",Mt,r(x.value.length),1),t[30]||(t[30]=C(" results "))]),e("div",Ft,[e("button",{onClick:t[7]||(t[7]=s=>S.value--),disabled:S.value===1,class:"btn btn-sm btn-outline"},[c(v(Pe),{class:"h-4 w-4"}),t[31]||(t[31]=e("span",{class:"hidden sm:inline"},"Previous",-1))],8,St),e("button",{onClick:t[8]||(t[8]=s=>S.value++),disabled:S.value>=G.value,class:"btn btn-sm btn-outline"},[t[32]||(t[32]=e("span",{class:"hidden sm:inline"},"Next",-1)),c(v(Ne),{class:"h-4 w-4"})],8,Pt)])])):g("",!0)]),c(ae,{"is-open":N.value,title:m.value?"Edit Expense":"Add New Expense",onClose:A,size:"xl"},{default:le(()=>[e("form",{onSubmit:$e(xe,["prevent"]),class:"space-y-4"},[e("div",Nt,[e("div",null,[t[33]||(t[33]=e("label",{class:"label"},"Expense Name *",-1)),f(e("input",{"onUpdate:modelValue":t[9]||(t[9]=s=>d.value.name=s),type:"text",required:"",class:"input",placeholder:"e.g. Office lunch"},null,512),[[E,d.value.name]])]),e("div",null,[t[35]||(t[35]=e("label",{class:"label"},"Amount *",-1)),e("div",Tt,[t[34]||(t[34]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("span",{class:"text-gray-500 sm:text-sm"},"$")],-1)),f(e("input",{"onUpdate:modelValue":t[10]||(t[10]=s=>d.value.amount=s),type:"number",step:"0.01",min:"0",required:"",class:"input pl-8",placeholder:"0.00"},null,512),[[E,d.value.amount,void 0,{number:!0}]])])])]),e("div",Ut,[e("div",null,[t[37]||(t[37]=e("label",{class:"label"},"Category *",-1)),f(e("select",{"onUpdate:modelValue":t[11]||(t[11]=s=>d.value.category_id=s),required:"",class:"select"},[t[36]||(t[36]=e("option",{disabled:"",value:""},"Select category",-1)),(o(!0),n($,null,M(B.value,s=>(o(),n("option",{key:s.id,value:s.id},r(s.name),9,jt))),128))],512),[[se,d.value.category_id]])]),e("div",null,[t[38]||(t[38]=e("label",{class:"label"},"Expense Date *",-1)),f(e("input",{"onUpdate:modelValue":t[12]||(t[12]=s=>d.value.expense_date=s),type:"date",required:"",class:"input"},null,512),[[E,d.value.expense_date]])])]),e("div",null,[t[39]||(t[39]=e("label",{class:"label"},"Notes / Description",-1)),f(e("textarea",{"onUpdate:modelValue":t[13]||(t[13]=s=>d.value.notes=s),class:"textarea",rows:"3",placeholder:"Add any relevant details..."},null,512),[[E,d.value.notes]])]),e("div",null,[t[40]||(t[40]=e("label",{class:"label"},"Upload Bill (optional)",-1)),e("input",{type:"file",onChange:ve,class:"file-input w-full"},null,32),m.value&&d.value.bill_url?(o(),n("p",At," A file is already uploaded. Uploading a new one will replace it. ")):g("",!0)]),e("div",Vt,[e("button",{type:"button",onClick:A,class:"btn btn-secondary"},"Cancel"),e("button",{type:"submit",disabled:k.value,class:"btn btn-primary"},r(k.value?"Saving...":m.value?"Update Expense":"Create Expense"),9,Bt)])],32)]),_:1},8,["is-open","title"]),c(ae,{"is-open":O.value,title:"PDF Preview",onClose:X,size:"xl"},{default:le(()=>[e("div",Ot,[F.value?(o(),n("iframe",{key:0,src:F.value,class:"w-full h-full border-0",title:"PDF Preview"},null,8,qt)):g("",!0)]),e("div",It,[e("button",{type:"button",onClick:X,class:"btn btn-outline"},"Close"),e("a",{href:F.value,download:`Expense_Report_${new Date().toISOString().split("T")[0]}.pdf`,class:"btn btn-primary"},"Download PDF",8,zt)])]),_:1},8,["is-open"])]))}});export{Wt as default};
